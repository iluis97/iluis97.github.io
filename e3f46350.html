<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>JVM 知识梳理 | LuisのBlog</title><meta name="author" content="Luis"><meta name="copyright" content="Luis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="oracle官方文档：https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;specs&#x2F;jvms&#x2F;se8&#x2F;html&#x2F;index.html JVM运行时内存区域 堆外内存堆外内存是指不在 JVM 堆空间内，但仍由应用程序控制和使用的内存区域。它不受 JVM 垃圾回收器（GC）直接管理。  *JVM不负责释放，需手动释放。*    特征 说明    不受 GC 控制 避免频繁 GC、减少 GC"><meta property="og:type" content="article"><meta property="og:title" content="JVM 知识梳理"><meta property="og:url" content="https://iluis.cn/e3f46350.html"><meta property="og:site_name" content="LuisのBlog"><meta property="og:description" content="oracle官方文档：https:&#x2F;&#x2F;docs.oracle.com&#x2F;javase&#x2F;specs&#x2F;jvms&#x2F;se8&#x2F;html&#x2F;index.html JVM运行时内存区域 堆外内存堆外内存是指不在 JVM 堆空间内，但仍由应用程序控制和使用的内存区域。它不受 JVM 垃圾回收器（GC）直接管理。  *JVM不负责释放，需手动释放。*    特征 说明    不受 GC 控制 避免频繁 GC、减少 GC"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://iluis.cn/img/luis/t3.jpg"><meta property="article:published_time" content="2025-05-09T05:12:02.000Z"><meta property="article:modified_time" content="2025-06-08T06:58:20.048Z"><meta property="article:author" content="Luis"><meta property="article:tag" content="JVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://iluis.cn/img/luis/t3.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://iluis.cn/e3f46350.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Luis","link":"链接: ","source":"来源: LuisのBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}
</script><div id="myscoll"></div><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"JVM 知识梳理",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-06-08 14:58:20"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/cat.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/luis/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/luis/t3.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="LuisのBlog"><span class="site-name">LuisのBlog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JVM 知识梳理</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-09T05:12:02.000Z" title="发表于 2025-05-09 13:12:02">2025-05-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-08T06:58:20.048Z" title="更新于 2025-06-08 14:58:20">2025-06-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/JVM/">JVM</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JVM 知识梳理"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>oracle官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html">https://docs.oracle.com/javase/specs/jvms/se8/html/index.html</a></p><h1 id="JVM运行时内存区域"><a href="#JVM运行时内存区域" class="headerlink" title="JVM运行时内存区域"></a>JVM运行时内存区域</h1><p><img src="/image/code-adventure/jvm/JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F.jpg" alt="JVM运行时内存区域"></p><h1 id="堆外内存"><a href="#堆外内存" class="headerlink" title="堆外内存"></a>堆外内存</h1><p><strong>堆外内存</strong>是指<strong>不在 JVM 堆空间内</strong>，但仍由应用程序控制和使用的内存区域。它不受 JVM 垃圾回收器（GC）直接管理。 *<em>JVM<br>不负责释放<br><strong><strong>，需</strong></strong>手动释放。</em>*</p><table><thead><tr><th>特征</th><th>说明</th></tr></thead><tbody><tr><td><strong>不受 GC 控制</strong></td><td>避免频繁 GC、减少 GC 停顿，适合缓存&#x2F;大对象</td></tr><tr><td><strong>生命周期可控</strong></td><td>需程序员手动分配和释放</td></tr><tr><td><strong>跨进程&#x2F;跨语言共享困难</strong></td><td>但适合本地通信或 JNI 交互</td></tr><tr><td><strong>常驻内存</strong></td><td>通常更靠近系统内存，回收更精细化</td></tr></tbody></table><table><thead><tr><th>使用场景</th><th>示例</th></tr></thead><tbody><tr><td><strong>高性能缓存系统</strong></td><td>Netty 的 <code>ByteBuf</code>、MapDB、ChronicleMap</td></tr><tr><td><strong>避免 GC 开销</strong></td><td>高频数据存取、缓存热点数据</td></tr><tr><td><strong>处理大对象或大文件</strong></td><td>零拷贝、文件映射、NIO buffer</td></tr><tr><td><strong>与本地代码交互</strong></td><td>JNI &#x2F; DirectBuffer &#x2F; Unsafe &#x2F; mmap</td></tr></tbody></table><p>常见使用方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocateDirect(<span class="number">1024</span>);</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>：直接分配堆外内存（Direct Memory）</li><li><strong>特点</strong>：由 OS 管理，GC 不会回收；性能优于堆内 NIO buffer</li><li><strong>释放</strong>：JVM 在不确定时间回收（或使用反射+Cleaner 手动回收）</li></ul><h1 id="常见异常"><a href="#常见异常" class="headerlink" title="常见异常"></a>常见异常</h1><h2 id="StackOverflowError"><a href="#StackOverflowError" class="headerlink" title="StackOverflowError"></a><code>StackOverflowError</code></h2><p>当线程的栈空间用完时，JVM 抛出 <code>StackOverflowError</code>。</p><h3 id="📌-常见触发场景"><a href="#📌-常见触发场景" class="headerlink" title="📌 常见触发场景"></a>📌 常见触发场景</h3><ol><li>无限递归调用</li><li>过深的调用链</li><li>每个栈帧占用过多局部变量（导致单方法调用就耗尽栈）</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackOverflowDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">recursive</span><span class="params">()</span> &#123;</span><br><span class="line">        recursive(); <span class="comment">// 无限递归</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        recursive();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>JVM 调优参数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xss256k  #设置单线程栈空间大小（默认 1M 左右）</span><br></pre></td></tr></table></figure><ul><li>减小 <code>-Xss</code> 会使一个线程栈帧更小，从而支持更多线程；</li><li>增大 <code>-Xss</code> 会支持更深的方法调用链，但线程数减少。</li></ul><h2 id="OutOfMemoryError（OOM）"><a href="#OutOfMemoryError（OOM）" class="headerlink" title="OutOfMemoryError（OOM）"></a><code>OutOfMemoryError</code>（OOM）</h2><p>JVM 无法为对象分配足够的内存空间时，抛出 <code>OutOfMemoryError</code>。它不是一种错误，而是内存分配失败的信号。</p><h3 id="📌-常见类型"><a href="#📌-常见类型" class="headerlink" title="📌 常见类型"></a>📌 常见类型</h3><table><thead><tr><th>类型</th><th>出现场景</th><th>原因</th><th><strong>解决方案</strong></th></tr></thead><tbody><tr><td><code>Java heap space</code></td><td>创建大量对象、集合过大</td><td>堆内存不足</td><td>1. 增大堆：-Xmx4g 2. 修复内存泄漏（如误用静态集合）</td></tr><tr><td><code>GC overhead limit exceeded</code></td><td>GC 花太多时间回收很少内存</td><td>内存紧张反复 GC</td><td>设置出现 OOM 自动 dump ，配合内存监控和堆转储分析</td></tr><tr><td><code>Metaspace</code>（JDK8+）</td><td>频繁加载新类、类信息泄露</td><td>元空间爆满</td><td>1. 增大元空间：-XX:MaxMetaspaceSize&#x3D;256m 2. 检查动态类生成（如反射、CGLIB）</td></tr><tr><td><code>Direct buffer memory</code></td><td>使用 NIO 分配堆外内存过多</td><td>超出 <code>-XX:MaxDirectMemorySize</code></td><td><code>-XX:MaxDirectMemorySize</code>调大</td></tr><tr><td><code>unable to create new native thread</code></td><td>线程数太多</td><td>OS 限制或 native 内存不足</td><td>1. 减少线程数 2. 调小 -Xss（谨慎使用）</td></tr><tr><td><code>Requested array size exceeds VM limit</code></td><td>申请数组过大</td><td>超过最大限制（如 2GB 限制）</td><td>拆分数据或检查计算逻辑</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapOOM</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span>]); <span class="comment">// 不断分配 1MB</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>JVM 调优参数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-Xms256m -Xmx256m        #设置堆大小</span><br><span class="line">-XX:MaxMetaspaceSize=64m #元空间限制</span><br><span class="line">-XX:MaxDirectMemorySize=64m #直接内存限制</span><br></pre></td></tr></table></figure><h3 id="常见触发场景"><a href="#常见触发场景" class="headerlink" title="常见触发场景"></a>常见触发场景</h3><table><thead><tr><th>场景</th><th>说明</th></tr></thead><tbody><tr><td><strong>无限增长的数据结构</strong></td><td>如 List、Map 没有限制持续添加元素</td></tr><tr><td><strong>缓存滥用</strong></td><td>缓存没有淘汰机制</td></tr><tr><td><strong>对象生命周期太长</strong></td><td>很少有对象被回收</td></tr><tr><td><strong>大对象&#x2F;死循环</strong></td><td>循环中创建大对象（如 byte[1024*1024]）</td></tr><tr><td><strong>低效GC策略</strong></td><td>不合理的垃圾收集器配置</td></tr><tr><td><strong>堆内存过小</strong></td><td><code>-Xmx</code>设置过低</td></tr><tr><td><strong>内存泄漏</strong></td><td>某些对象无法释放（如 ThreadLocal 泄漏） 对象持续增长无法回收（如静态Map未清理）</td></tr></tbody></table><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a><strong>解决方案</strong></h3><h4 id="紧急处理（临时）"><a href="#紧急处理（临时）" class="headerlink" title="紧急处理（临时）"></a>紧急处理（临时）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 禁用GC超限检查（仅临时测试用，不解决根本问题）</span></span><br><span class="line">java -XX:-UseGCOverheadLimit -jar your_app.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增大堆内存（示例：设置4G堆）</span></span><br><span class="line">java -Xms1g -Xmx4g -jar your_app.jar</span><br></pre></td></tr></table></figure><h4 id="根本性修复"><a href="#根本性修复" class="headerlink" title="根本性修复"></a>根本性修复</h4><p>定位内存泄漏，用工具分析堆转储：</p><ul><li><strong>Eclipse MAT</strong><br>：查看 <code>Dominator Tree</code><br>找到占用最大的对象</li><li><strong>VisualVM</strong>：检查对象增长趋势</li></ul><p><strong>修复代码漏洞</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 案例：修复静态Map泄漏</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeakFix</span> &#123;</span><br><span class="line">    <span class="comment">// 错误：静态集合未清理 → 改用WeakHashMap</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Key, Value&gt; cache = <span class="keyword">new</span> <span class="title class_">WeakHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 或添加定期清理逻辑</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clearCache</span><span class="params">()</span> &#123;</span><br><span class="line">        cache.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>优化数据存储</strong></p><ul><li>避免用 <code>List</code>&#x2F;<code>Map</code><br>存储海量数据 → 改用数据库或分片存储</li><li>用 <code>Stream</code><br>处理大文件替代全量加载</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误：Files.readAllLines() 加载大文件</span></span><br><span class="line"><span class="comment">// 正确：流式处理</span></span><br><span class="line"><span class="keyword">try</span>(Stream&lt;String&gt; lines = Files.lines(Paths.get(<span class="string">&quot;large.txt&quot;</span>)))&#123;</span><br><span class="line">        lines.</span><br><span class="line"></span><br><span class="line">filter(line -&gt;line.</span><br><span class="line"></span><br><span class="line">contains(<span class="string">&quot;key&quot;</span>)).</span><br><span class="line"></span><br><span class="line">forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>调整GC策略</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到G1收集器（适合大堆内存）</span></span><br><span class="line">java -XX:+UseG1GC -Xmx4g ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调整G1关键参数（根据机器配置）</span></span><br><span class="line">-XX:G1NewSizePercent=30 </span><br><span class="line">-XX:MaxGCPauseMillis=200</span><br></pre></td></tr></table></figure><h3 id="预防措施"><a href="#预防措施" class="headerlink" title="预防措施"></a><strong>预防措施</strong></h3><ul><li><strong>监控GC行为</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#打印GC详情</span><br><span class="line">java -Xlog:gc*-</span><br><span class="line">jar your_app.jar</span><br><span class="line"></span><br><span class="line">#或使用JConsole/VisualVM实时监控</span><br></pre></td></tr></table></figure><ul><li><strong>压力测试</strong><br>：用JMeter模拟高负载，提前暴露问题</li><li><strong>内存限制</strong><br>：容器环境（如Docker）需同步调整 <code>-Xmx</code><br>和容器内存上限</li></ul><h2 id="诊断建议"><a href="#诊断建议" class="headerlink" title="诊断建议"></a>诊断建议</h2><table><thead><tr><th>工具</th><th>用途</th></tr></thead><tbody><tr><td><code>jstack</code></td><td>打印线程栈，查看栈溢出原因</td></tr><tr><td><code>jmap -heap</code></td><td>查看堆使用情况</td></tr><tr><td><code>VisualVM</code> &#x2F; <code>MAT</code></td><td>分析堆转储文件，定位 OOM 源头</td></tr><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>出现 OOM 自动 dump 内存</td></tr></tbody></table><h1 id="GC收集器"><a href="#GC收集器" class="headerlink" title="GC收集器"></a>GC收集器</h1><p>选择垃圾回收器</p><table><thead><tr><th>收集器名称</th><th>类型</th><th>特点</th><th>JDK 支持版本</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Serial GC</strong></td><td>单线程</td><td>简单、停顿时间长</td><td>JDK 1.2+</td><td>小内存、客户端应用</td></tr><tr><td><strong>ParNew GC</strong></td><td>多线程</td><td>Serial 的并行版</td><td>JDK 1.4+</td><td>配合 CMS 使用</td></tr><tr><td><strong>Parallel GC（吞吐量优先）</strong></td><td>多线程</td><td>默认收集器，关注吞吐量</td><td>JDK 1.5+</td><td>高吞吐、无实时性要求</td></tr><tr><td><strong>CMS（Concurrent Mark Sweep）</strong></td><td>并发</td><td>低延迟，响应快，老年代并发回收， 并发标记清除，低停顿</td><td>JDK 1.5+（JDK 14 废弃）</td><td>适合 Web 服务（如电商）</td></tr><tr><td><strong>G1（Garbage First）</strong></td><td>并发+分区</td><td>预测停顿时间、堆切分为 Region</td><td>JDK 7u4+（JDK 9 默认）</td><td>大内存场景、可预测停顿</td></tr><tr><td><strong>ZGC（Z Garbage Collector）</strong></td><td>并发</td><td>极低延迟（&lt;10ms），支持 TB 级堆</td><td>JDK 11+</td><td>大数据、低延迟要求</td></tr></tbody></table><h1 id="JVM参数"><a href="#JVM参数" class="headerlink" title="JVM参数"></a>JVM参数</h1><h2 id="三种类型"><a href="#三种类型" class="headerlink" title="三种类型"></a>三种类型</h2><h3 id="标准参数（-）"><a href="#标准参数（-）" class="headerlink" title="标准参数（-）"></a><strong>标准参数（-）</strong></h3><p>这些参数由 Java 官方规范定义，适用于所有 JVM 实现，通常以 <code>-</code> 开头。</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-classpath</code> 或 <code>-cp</code></td><td>设置类路径</td></tr><tr><td><code>-D&lt;name&gt;=&lt;value&gt;</code></td><td>设置系统属性</td></tr><tr><td><code>-version</code></td><td>查看当前 JVM 版本</td></tr><tr><td><code>-jar</code></td><td>运行可执行 JAR 包</td></tr><tr><td><code>-X</code></td><td>查看所有非标准参数</td></tr><tr><td><code>-help</code></td><td>显示帮助信息</td></tr></tbody></table><h3 id="非标准参数（-X）"><a href="#非标准参数（-X）" class="headerlink" title="非标准参数（-X）"></a>非标准参数（-X）</h3><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-Xms&lt;size&gt;</code></td><td>初始堆大小</td></tr><tr><td><code>-Xmx&lt;size&gt;</code></td><td>最大堆大小</td></tr><tr><td><code>-Xmn&lt;size&gt;</code></td><td>新生代大小</td></tr><tr><td><code>-Xss&lt;size&gt;</code></td><td>每个线程栈大小</td></tr><tr><td><code>-Xloggc:&lt;file&gt;</code></td><td>将 GC 日志输出到文件</td></tr><tr><td><code>-XshowSettings</code></td><td>显示 JVM 配置</td></tr></tbody></table><h3 id="高级参数（-XX）"><a href="#高级参数（-XX）" class="headerlink" title="高级参数（-XX）"></a><strong>高级参数（-XX）</strong></h3><p>这也是非标准化参数，相对来说不稳定，随着JVM版本的变化可能会发生变化，主要用于JVM调优和debug。</p><p>该参数的书写形式又分为两大类：</p><h4 id="Boolean类型"><a href="#Boolean类型" class="headerlink" title="Boolean类型"></a>Boolean类型</h4><p>格式：-XX:[+-] 表示启用或者禁用name属性。</p><p>例子：-XX:+UseG1GC（表示启用G1垃圾收集器）</p><h4 id="Key-Value类型"><a href="#Key-Value类型" class="headerlink" title="Key-Value类型"></a>Key-Value类型</h4><p>格式：-XX:&#x3D; 表示name的属性值为value。</p><p>例子：-XX:MaxGCPauseMillis&#x3D;500（表示设置GC的最大停顿时间是500ms）</p><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-XX:+UseG1GC</code></td><td>启用 G1 垃圾回收器</td></tr><tr><td><code>-XX:+PrintGCDetails</code></td><td>打印详细 GC 日志</td></tr><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>OOM 时生成 heap dump</td></tr><tr><td><code>-XX:MaxMetaspaceSize=256m</code></td><td>设置元空间上限</td></tr><tr><td><code>-XX:+UseCompressedOops</code></td><td>启用对象指针压缩（默认启用）</td></tr><tr><td><code>-XX:+UnlockExperimentalVMOptions</code></td><td>解锁实验参数（如使用 ZGC）</td></tr></tbody></table><h1 id="JVM启动参数"><a href="#JVM启动参数" class="headerlink" title="JVM启动参数"></a>JVM启动参数</h1><h2 id="堆内存设置（控制堆结构）"><a href="#堆内存设置（控制堆结构）" class="headerlink" title="堆内存设置（控制堆结构）"></a>堆内存设置（控制堆结构）</h2><table><thead><tr><th>参数</th><th>说明</th><th>常用值</th><th>适用场景</th></tr></thead><tbody><tr><td><code>-Xms</code></td><td>初始堆大小</td><td>与 <code>-Xmx</code> 一致</td><td>避免扩容带来的 Full GC</td></tr><tr><td><code>-Xmx</code></td><td>最大堆大小</td><td>如 <code>2g</code>, <code>4g</code>, <code>8g</code></td><td>根据业务内存压力设定</td></tr><tr><td><code>-Xmn</code></td><td>新生代大小</td><td>如 <code>512m</code>, <code>1g</code></td><td>请求频繁、短命对象多的应用</td></tr><tr><td><code>-XX:NewRatio</code></td><td>老年代:新生代比例</td><td>默认 <code>2</code>；推荐 <code>1~4</code></td><td>控制新老代比，无 <code>-Xmn</code> 时生效</td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>Eden 与 Survivor 比</td><td>默认 <code>8</code>，可调 <code>6~10</code></td><td>Survivor 不足时调小此值</td></tr><tr><td><code>-XX:MaxTenuringThreshold</code></td><td>对象在 Survivor 区存活几次后晋升老年代</td><td><code>1~15</code>（默认 <code>15</code>）</td><td>短命对象多时建议设小，避免 Survivor 溢出</td></tr></tbody></table><h2 id="GC-策略与相关参数"><a href="#GC-策略与相关参数" class="headerlink" title="GC 策略与相关参数"></a>GC 策略与相关参数</h2><table><thead><tr><th>参数</th><th>说明</th><th>建议值</th><th>适用场景</th></tr></thead><tbody><tr><td><code>-XX:+UseG1GC</code></td><td>使用 G1 收集器</td><td>✅ 推荐</td><td>大堆、响应敏感场景</td></tr><tr><td><code>-XX:+UseZGC</code></td><td>使用 ZGC</td><td>✅ 新版本</td><td>超低延迟（&lt;10ms），大内存场景</td></tr><tr><td><code>-XX:+UseParallelGC</code></td><td>吞吐优先</td><td>适合计算型任务</td><td></td></tr><tr><td><code>-XX:+UseSerialGC</code></td><td>单线程 GC</td><td>嵌入式、低资源环境</td><td></td></tr><tr><td><code>-XX:MaxGCPauseMillis</code></td><td>G1 GC 最大暂停时间期望</td><td>目标如 <code>200</code> 毫秒</td><td>G1 调优核心参数</td></tr><tr><td><code>-XX:G1HeapRegionSize</code></td><td>G1 分区粒度</td><td><code>1m</code>, <code>2m</code>, <code>4m</code> 等</td><td>堆大时设置大粒度（4g 以上设 4m）</td></tr><tr><td><code>-XX:InitiatingHeapOccupancyPercent</code></td><td>G1 触发并发 GC 阈值</td><td>默认 <code>45</code>，推荐 <code>30~40</code></td><td>降低 Full GC 触发概率</td></tr></tbody></table><h2 id="诊断与稳定性参数"><a href="#诊断与稳定性参数" class="headerlink" title="诊断与稳定性参数"></a>诊断与稳定性参数</h2><table><thead><tr><th>参数</th><th>说明</th><th>用途</th></tr></thead><tbody><tr><td><code>-XX:+PrintGCDetails</code></td><td>打印 GC 详情</td><td>分析 GC 情况</td></tr><tr><td><code>-XX:+PrintGCDateStamps</code></td><td>打印时间戳</td><td>精准定位 GC 时间</td></tr><tr><td><code>-Xloggc:&lt;file&gt;</code></td><td>GC 日志输出路径</td><td>GC 分析工具输入</td></tr><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>OOM 时导出堆快照</td><td>内存泄漏排查</td></tr><tr><td><code>-XX:HeapDumpPath=&lt;file&gt;</code></td><td>OOM dump 文件路径</td><td>搭配上面参数使用</td></tr><tr><td><code>-XX:+UseContainerSupport</code></td><td>支持容器内资源限制</td><td>默认开启（JDK10+）</td></tr></tbody></table><h1 id="JDK8场景"><a href="#JDK8场景" class="headerlink" title="JDK8场景"></a>JDK8场景</h1><p>构建gc代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.jdk8.tech.jvm.gc_tech;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Luis</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2025/06/04 12:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GcDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">_1MB</span> <span class="operator">=</span> <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 用于填充Eden的对象列表</span></span><br><span class="line">        List&lt;<span class="type">byte</span>[]&gt; edenContainer = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;开始填充Eden区...&quot;</span>);</span><br><span class="line">        <span class="comment">// 持续分配对象</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 分配一个0.5MB - 1.5MB大小的对象 (避免全是相同大小,日志几乎相同)</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">500</span> * <span class="number">1024</span> + random.nextInt(<span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">            <span class="comment">// 持有引用，防止立即被回收</span></span><br><span class="line">            edenContainer.add(<span class="keyword">new</span> <span class="title class_">byte</span>[size]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 模拟一点点业务逻辑，稍微减慢分配速度，更贴近真实场景</span></span><br><span class="line">            Thread.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 可选：定期移除部分引用，让部分对象可回收（模拟部分短命对象）</span></span><br><span class="line">            <span class="keyword">if</span> (edenContainer.size() % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 移除列表前50个元素的引用 (让它们在下文GC中可回收)</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span> &amp;&amp; !edenContainer.isEmpty(); i++) &#123;</span><br><span class="line">                    edenContainer.remove(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>添加jvm启动命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># for idea vm</span><br><span class="line">-Xms512m</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xmn128m</span><br><span class="line">-XX:SurvivorRatio=8</span><br><span class="line">-XX:+UseParNewGC</span><br><span class="line">-XX:+UseConcMarkSweepGC</span><br><span class="line">-XX:CMSInitiatingOccupancyFraction=75</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-Xloggc:gc.log</span><br><span class="line"></span><br><span class="line"># for jar</span><br><span class="line">java -Xms512m -Xmx512m \ # 堆总大小512MB</span><br><span class="line">     -Xmn256m            \ # 新生代256MB (Eden + S0 + S1)</span><br><span class="line">     -XX:SurvivorRatio=8 \ # Eden:S0:S1 = 8:1:1 (Eden~204.8MB, S0/S1~25.6MB)</span><br><span class="line">     -XX:+UseParNewGC    \ # 新生代使用ParNew</span><br><span class="line">     -XX:+UseConcMarkSweepGC \ # 老年代使用CMS</span><br><span class="line">     -XX:CMSInitiatingOccupancyFraction=75 \ # 老年代使用75%时启动CMS</span><br><span class="line">     -XX:+UseCMSInitiatingOccupancyOnly \ # 仅根据占用率触发CMS</span><br><span class="line">     -XX:+PrintGCDetails \ # 打印详细GC日志</span><br><span class="line">     -XX:+PrintGCDateStamps \ # 打印GC发生时间</span><br><span class="line">     -XX:+PrintTenuringDistribution \ # 打印晋升年龄信息</span><br><span class="line">     -Xloggc:gc.log      \ # 将GC日志输出到gc.log</span><br><span class="line">     -XX:+DisableExplicitGC \ # 禁止System.gc()干扰</span><br><span class="line">     -jar demo-luis.jar</span><br></pre></td></tr></table></figure><p>gc部分日志</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Java HotSpot(TM) 64-Bit Server VM (25.202-b08) for windows-amd64 JRE (1.8.0_202-b08), built on Dec 15 2018 19:54:30 by &quot;java_re&quot; with MS VC++ 10.0 (VS2010)</span><br><span class="line">Memory: 4k page, physical 33363252k(16577640k free), swap 39130420k(12508580k free)</span><br><span class="line">CommandLine flags: -XX:CMSInitiatingOccupancyFraction=75 -XX:InitialHeapSize=536870912 -XX:MaxHeapSize=536870912 -XX:MaxNewSize=134217728 -XX:NewSize=134217728 -XX:OldPLABSize=16 -XX:+PrintGC -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:SurvivorRatio=8 -XX:+UseCMSInitiatingOccupancyOnly -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:-UseLargePagesIndividualAllocation -XX:+UseParNewGC </span><br><span class="line">2025-06-04T12:27:23.753+0800: 0.169: [GC (Allocation Failure) 2025-06-04T12:27:23.753+0800: 0.170: [ParNew: 104876K-&gt;12778K(118016K), 0.0163323 secs] 104876K-&gt;51738K(511232K), 0.0164134 secs] [Times: user=0.00 sys=0.00, real=0.02 secs] </span><br><span class="line">2025-06-04T12:27:23.880+0800: 0.297: [GC (Allocation Failure) 2025-06-04T12:27:23.880+0800: 0.297: [ParNew: 116554K-&gt;13050K(118016K), 0.0284856 secs] 155514K-&gt;141179K(511232K), 0.0285187 secs] [Times: user=0.06 sys=0.02, real=0.03 secs] </span><br><span class="line">2025-06-04T12:27:24.026+0800: 0.443: [GC (Allocation Failure) 2025-06-04T12:27:24.026+0800: 0.443: [ParNew: 117547K-&gt;12861K(118016K), 0.0274540 secs] 245676K-&gt;228752K(511232K), 0.0274894 secs] [Times: user=0.05 sys=0.03, real=0.03 secs] </span><br><span class="line">2025-06-04T12:27:24.172+0800: 0.589: [GC (Allocation Failure) 2025-06-04T12:27:24.172+0800: 0.589: [ParNew: 117126K-&gt;12795K(118016K), 0.0144786 secs] 333017K-&gt;266179K(511232K), 0.0145109 secs] [Times: user=0.01 sys=0.00, real=0.01 secs] </span><br><span class="line">2025-06-04T12:27:24.307+0800: 0.724: [GC (Allocation Failure) 2025-06-04T12:27:24.307+0800: 0.724: [ParNew: 117465K-&gt;12893K(118016K), 0.0179375 secs] 370849K-&gt;312796K(511232K), 0.0179793 secs] [Times: user=0.02 sys=0.00, real=0.02 secs] </span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [GC (CMS Initial Mark) [1 CMS-initial-mark: 299903K(393216K)] 313996K(511232K), 0.0001349 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [CMS-concurrent-mark-start]</span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [CMS-concurrent-mark: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [CMS-concurrent-preclean-start]</span><br><span class="line">2025-06-04T12:27:24.326+0800: 0.743: [CMS-concurrent-preclean: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.326+0800: 0.743: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">2025-06-04T12:27:24.445+0800: 0.861: [GC (Allocation Failure) 2025-06-04T12:27:24.445+0800: 0.861: [ParNew: 117642K-&gt;12925K(118016K), 0.0192145 secs] 417545K-&gt;359678K(511232K), 0.0192600 secs] [Times: user=0.00 sys=0.00, real=0.02 secs] </span><br><span class="line">2025-06-04T12:27:24.464+0800: 0.881: [CMS-concurrent-abortable-preclean: 0.000/0.138 secs] [Times: user=0.00 sys=0.00, real=0.14 secs] </span><br><span class="line">2025-06-04T12:27:24.464+0800: 0.881: [GC (CMS Final Remark) [YG occupancy: 13523 K (118016 K)]2025-06-04T12:27:24.464+0800: 0.881: [Rescan (parallel) , 0.0004817 secs]2025-06-04T12:27:24.464+0800: 0.881: [weak refs processing, 0.0000105 secs]2025-06-04T12:27:24.464+0800: 0.881: [class unloading, 0.0001355 secs]2025-06-04T12:27:24.464+0800: 0.881: [scrub symbol table, 0.0001910 secs]2025-06-04T12:27:24.464+0800: 0.882: [scrub string table, 0.0000666 secs][1 CMS-remark: 346752K(393216K)] 360275K(511232K), 0.0009259 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.465+0800: 0.882: [CMS-concurrent-sweep-start]</span><br><span class="line">2025-06-04T12:27:24.465+0800: 0.882: [CMS-concurrent-sweep: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.465+0800: 0.882: [CMS-concurrent-reset-start]</span><br><span class="line">2025-06-04T12:27:24.466+0800: 0.883: [CMS-concurrent-reset: 0.001/0.001 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.580+0800: 0.997: [GC (Allocation Failure) 2025-06-04T12:27:24.580+0800: 0.997: [ParNew: 116700K-&gt;12917K(118016K), 0.0079314 secs] 210742K-&gt;160642K(511232K), 0.0079722 secs] [Times: user=0.02 sys=0.00, real=0.01 secs] </span><br><span class="line">2025-06-04T12:27:24.697+0800: 1.114: [GC (Allocation Failure) 2025-06-04T12:27:24.697+0800: 1.114: [ParNew: 117278K-&gt;13019K(118016K), 0.0148061 secs] 265003K-&gt;209342K(511232K), 0.0148437 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">2025-06-04T12:27:24.827+0800: 1.244: [GC (Allocation Failure) 2025-06-04T12:27:24.827+0800: 1.244: [ParNew: 117829K-&gt;12799K(118016K), 0.0058725 secs] 314153K-&gt;258724K(511232K), 0.0059129 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">2025-06-04T12:27:24.959+0800: 1.376: [GC (Allocation Failure) 2025-06-04T12:27:24.959+0800: 1.376: [ParNew: 117566K-&gt;13016K(118016K), 0.0070007 secs] 363491K-&gt;315011K(511232K), 0.0070522 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">2025-06-04T12:27:24.965+0800: 1.383: [GC (CMS Initial Mark) [1 CMS-initial-mark: 301994K(393216K)] 315720K(511232K), 0.0001801 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.965+0800: 1.383: [CMS-concurrent-mark-start]</span><br><span class="line">2025-06-04T12:27:24.967+0800: 1.384: [CMS-concurrent-mark: 0.001/0.001 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.967+0800: 1.384: [CMS-concurrent-preclean-start]</span><br><span class="line">2025-06-04T12:27:24.967+0800: 1.384: [CMS-concurrent-preclean: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:24.967+0800: 1.384: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">2025-06-04T12:27:25.091+0800: 1.508: [GC (Allocation Failure) 2025-06-04T12:27:25.091+0800: 1.508: [ParNew: 116822K-&gt;12800K(118016K), 0.0073121 secs] 418817K-&gt;372648K(511232K), 0.0073478 secs] [Times: user=0.00 sys=0.00, real=0.01 secs] </span><br><span class="line">2025-06-04T12:27:25.098+0800: 1.515: [CMS-concurrent-abortable-preclean: 0.001/0.131 secs] [Times: user=0.00 sys=0.00, real=0.13 secs] </span><br><span class="line">2025-06-04T12:27:25.098+0800: 1.515: [GC (CMS Final Remark) [YG occupancy: 14025 K (118016 K)]2025-06-04T12:27:25.099+0800: 1.515: [Rescan (parallel) , 0.0003286 secs]2025-06-04T12:27:25.099+0800: 1.516: [weak refs processing, 0.0000050 secs]2025-06-04T12:27:25.099+0800: 1.516: [class unloading, 0.0001736 secs]2025-06-04T12:27:25.099+0800: 1.516: [scrub symbol table, 0.0002183 secs]2025-06-04T12:27:25.099+0800: 1.516: [scrub string table, 0.0000787 secs][1 CMS-remark: 359847K(393216K)] 373872K(511232K), 0.0008354 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:25.099+0800: 1.516: [CMS-concurrent-sweep-start]</span><br><span class="line">2025-06-04T12:27:25.100+0800: 1.516: [CMS-concurrent-sweep: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:25.100+0800: 1.516: [CMS-concurrent-reset-start]</span><br><span class="line">2025-06-04T12:27:25.100+0800: 1.517: [CMS-concurrent-reset: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line">2025-06-04T12:27:25.219+0800: 1.636: [GC (Allocation Failure) 2025-06-04T12:27:25.219+0800: 1.636: [ParNew: 117623K-&gt;12593K(118016K), 0.0076113 secs] 232551K-&gt;196120K(511232K), 0.0076467 secs] [Times: user=0.03 sys=0.00, real=0.01 secs] </span><br><span class="line">Heap</span><br><span class="line"> par new generation   total 118016K, used 61904K [0x00000000e0000000, 0x00000000e8000000, 0x00000000e8000000)</span><br><span class="line">  eden space 104960K,  46% used [0x00000000e0000000, 0x00000000e3027a68, 0x00000000e6680000)</span><br><span class="line">  from space 13056K,  96% used [0x00000000e6680000, 0x00000000e72cc660, 0x00000000e7340000)</span><br><span class="line">  to   space 13056K,   0% used [0x00000000e7340000, 0x00000000e7340000, 0x00000000e8000000)</span><br><span class="line"> concurrent mark-sweep generation total 393216K, used 183527K [0x00000000e8000000, 0x0000000100000000, 0x0000000100000000)</span><br><span class="line"> Metaspace       used 3747K, capacity 4604K, committed 4864K, reserved 1056768K</span><br><span class="line">  class space    used 409K, capacity 428K, committed 512K, reserved 1048576K</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CommandLine-flags"><a href="#CommandLine-flags" class="headerlink" title="CommandLine flags"></a>CommandLine flags</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">堆配置：</span><br><span class="line">  - 总堆：512MB (536,870,912B)</span><br><span class="line">  - 新生代：128MB (134,217,728B)</span><br><span class="line">    - Eden：104,960KB (128MB × 8/10)</span><br><span class="line">    - Survivor ×2：各13,056KB (128MB × 1/10)</span><br><span class="line">  - 老年代：384MB (393,216KB)</span><br><span class="line">GC策略：</span><br><span class="line">  - 新生代：ParNew (并行复制)</span><br><span class="line">  - 老年代：CMS (并发标记清除)</span><br><span class="line">触发条件：</span><br><span class="line">  - CMS在75<span class="comment">%老年代占用时触发 (393,216KB × 0.75 = 294,912KB)</span></span><br></pre></td></tr></table></figure><h2 id="新生代GC"><a href="#新生代GC" class="headerlink" title="新生代GC"></a>新生代GC</h2><p>日志解析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2025-06-04T12:27:23.753+0800:</span><br><span class="line">0.169:</span><br><span class="line">[GC (Allocation Failure)</span><br><span class="line">2025-06-04T12:27:23.753+0800: 0.170:</span><br><span class="line">[ParNew: 104876K-&gt;12778K(118016K), 0.0163323 secs] </span><br><span class="line">104876K-&gt;51738K(511232K), 0.0164134 secs]</span><br><span class="line">[Times: user=0.00 sys=0.00, real=0.02 secs] </span><br></pre></td></tr></table></figure><table><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td><code>2025-06-04T12:27:23.753+0800</code></td><td>日志时间戳，表示发生 GC 的<strong>实际日期和时间</strong>。</td></tr><tr><td><code>0.169</code></td><td>从 JVM 启动以来的时间（单位：秒），即在启动后 <strong>0.169 秒时</strong>发生 GC。</td></tr><tr><td><code>[GC (Allocation Failure)</code></td><td>GC 类型为 <strong>Minor GC</strong>，原因是内存分配失败（Eden 区不足）。</td></tr><tr><td><code>2025-06-04T12:27:23.753+0800: 0.170:</code></td><td>再次打印时间戳，重复信息，有时用于记录多线程 GC 内部时间点。</td></tr><tr><td><code>[ParNew: 104876K-&gt;12778K(118016K)</code></td><td><strong>ParNew 新生代 GC 详细信息</strong>：<br>• GC 前使用 <code>104876K</code><br>• GC 后剩 <code>12778K</code><br>• 新生代总大小 <code>118016K</code></td></tr><tr><td><code>0.0163323 secs]</code></td><td>这一阶段 GC 耗时约 <code>16.3 毫秒</code>。</td></tr><tr><td><code>104876K-&gt;51738K(511232K)</code></td><td>整个堆（包括新生代 + 老年代）变化：<br> • GC 前总使用 <code>104876K</code><br>• GC 后总使用 <code>51738K</code><br>• 总堆大小为 <code>511232K</code></td></tr><tr><td><code>0.0164134 secs]</code></td><td>总的 GC 耗时（包括从新生代复制到老年代的时间）约 <code>16.4 毫秒</code>。</td></tr><tr><td><code>[Times: user=0.00 sys=0.00, real=0.02 secs]</code></td><td>GC 线程的 CPU 使用时间：<br>• <code>user</code>: 用户态线程时间<br>• <code>sys</code>: 内核态线程时间<br>• <code>real</code>: 实际时间（挂钟时间）为 <code>0.02 秒</code></td></tr></tbody></table><h2 id="老年代GC"><a href="#老年代GC" class="headerlink" title="老年代GC"></a>老年代GC</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># CMS GC 的第一阶段：初始标记。此阶段会 STW（Stop-The-World），标记从 GC Roots 可达的老年代对象。</span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [GC (CMS Initial Mark) [1 CMS-initial-mark: 299903K(393216K)] 313996K(511232K), 0.0001349 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line"></span><br><span class="line"># CMS 并发标记阶段开始。该阶段不会 STW，GC 线程会并发地遍历对象图。</span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [CMS-concurrent-mark-start]</span><br><span class="line"></span><br><span class="line"># CMS 的 并发标记阶段结束，耗时接近 0，说明要么没啥可标记的，要么系统负载极低，速度非常快。</span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [CMS-concurrent-mark: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line"></span><br><span class="line"># 并发预清理阶段：GC 会尝试处理 minor GC 后新产生的垃圾（避免最终 remark STW 负担过重）。这一步耗时极短，表示垃圾量不大。</span><br><span class="line">2025-06-04T12:27:24.325+0800: 0.742: [CMS-concurrent-preclean-start]</span><br><span class="line">2025-06-04T12:27:24.326+0800: 0.743: [CMS-concurrent-preclean: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line"></span><br><span class="line"># 可中断预清理阶段开始：CMS 在等待触发 Final Remark 前，反复尝试进一步清理垃圾，可以被打断（如遇 Allocation Failure）。</span><br><span class="line">2025-06-04T12:27:24.326+0800: 0.743: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line"></span><br><span class="line"># 分配失败（新对象没地方放），触发了 minor GC（年轻代 GC）</span><br><span class="line"># # 这次 Allocation Failure 导致终止了 CMS 的 abortable preclean，转入 Final Remark。</span><br><span class="line">2025-06-04T12:27:24.445+0800: 0.861: [GC (Allocation Failure) 2025-06-04T12:27:24.445+0800: 0.861: [ParNew: 117642K-&gt;12925K(118016K), 0.0192145 secs] 417545K-&gt;359678K(511232K), 0.0192600 secs] [Times: user=0.00 sys=0.00, real=0.02 secs] </span><br><span class="line"></span><br><span class="line"># 可中断预清理阶段结束，总耗时 138ms，说明预清理尝试了多轮，最终被 allocation failure 中断。</span><br><span class="line">2025-06-04T12:27:24.464+0800: 0.881: [CMS-concurrent-abortable-preclean: 0.000/0.138 secs] [Times: user=0.00 sys=0.00, real=0.14 secs] </span><br><span class="line"></span><br><span class="line"># CMS GC 的 最终标记阶段（Final Remark），STW。子阶段细节后面介绍</span><br><span class="line">2025-06-04T12:27:24.464+0800: 0.881: [GC (CMS Final Remark) [YG occupancy: 13523 K (118016 K)]2025-06-04T12:27:24.464+0800: 0.881: [Rescan (parallel) , 0.0004817 secs]2025-06-04T12:27:24.464+0800: 0.881: [weak refs processing, 0.0000105 secs]2025-06-04T12:27:24.464+0800: 0.881: [class unloading, 0.0001355 secs]2025-06-04T12:27:24.464+0800: 0.881: [scrub symbol table, 0.0001910 secs]2025-06-04T12:27:24.464+0800: 0.882: [scrub string table, 0.0000666 secs][1 CMS-remark: 346752K(393216K)] 360275K(511232K), 0.0009259 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line"></span><br><span class="line"># 并发清除阶段：回收 unreachable 的老年代对象空间。完成得几乎瞬间，说明老年代垃圾量少或刚被清理过。</span><br><span class="line">2025-06-04T12:27:24.465+0800: 0.882: [CMS-concurrent-sweep-start]</span><br><span class="line">2025-06-04T12:27:24.465+0800: 0.882: [CMS-concurrent-sweep: 0.000/0.000 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line"></span><br><span class="line"># CMS GC 结束，重置 GC 状态，为下一次 GC 做准备。</span><br><span class="line">2025-06-04T12:27:24.465+0800: 0.882: [CMS-concurrent-reset-start]</span><br><span class="line">2025-06-04T12:27:24.466+0800: 0.883: [CMS-concurrent-reset: 0.001/0.001 secs] [Times: user=0.00 sys=0.00, real=0.00 secs] </span><br></pre></td></tr></table></figure><h3 id="GC-的-初始标记参数解析"><a href="#GC-的-初始标记参数解析" class="headerlink" title="GC 的 初始标记参数解析"></a>GC 的 初始标记参数解析</h3><table><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td><code>GC (CMS Initial Mark)</code></td><td>CMS GC 的第一阶段：<strong>初始标记</strong>。此阶段会 STW（Stop-The-World），标记从 GC Roots 可达的老年代对象。</td></tr><tr><td><code>1 CMS-initial-mark: 299903K(393216K)</code></td><td>老年代（CMS）中已有对象为 <code>299903K</code>，总容量为 <code>393216K</code>。</td></tr><tr><td><code>313996K(511232K)</code></td><td>整个堆（包括年轻代）当前占用 <code>313996K</code>，堆总容量为 <code>511232K</code>。</td></tr><tr><td><code>0.0001349 secs</code></td><td>初始标记耗时极短，仅 <code>0.13ms</code>，说明堆对象不多，系统空闲度较高。</td></tr><tr><td>[Times: user&#x3D;0.00 sys&#x3D;0.00, real&#x3D;0.00 secs]</td><td>用户态 CPU 时间（线程并发运行）。 内核态 CPU 时间。 实际墙上时间（即 STW 时间）。此处为 0.00 秒，说明极其短暂，甚至小于 1ms。</td></tr></tbody></table><h3 id="GC-的-最终标记阶段"><a href="#GC-的-最终标记阶段" class="headerlink" title="GC 的 最终标记阶段"></a>GC 的 最终标记阶段</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2025-06-04T12:27:24.464+0800: 0.881: </span><br><span class="line">[GC (CMS Final Remark) </span><br><span class="line">    # 子阶段</span><br><span class="line">    [YG occupancy: 13523 K (118016 K)]2025-06-04T12:27:24.464+0800: 0.881: </span><br><span class="line">    [Rescan (parallel) , 0.0004817 secs]2025-06-04T12:27:24.464+0800: 0.881: </span><br><span class="line">    [weak refs processing, 0.0000105 secs]2025-06-04T12:27:24.464+0800: 0.881: </span><br><span class="line">    [class unloading, 0.0001355 secs]2025-06-04T12:27:24.464+0800: 0.881: </span><br><span class="line">    [scrub symbol table, 0.0001910 secs]2025-06-04T12:27:24.464+0800: 0.882: </span><br><span class="line">    [scrub string table, 0.0000666 secs]</span><br><span class="line">[1 CMS-remark: 346752K(393216K)] </span><br><span class="line">360275K(511232K), </span><br><span class="line">0.0009259 secs] </span><br><span class="line">[Times: user=0.00 sys=0.00, real=0.00 secs] </span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="最终标记阶段（Final-Remark）-参数解析"><a href="#最终标记阶段（Final-Remark）-参数解析" class="headerlink" title="最终标记阶段（Final Remark） 参数解析"></a>最终标记阶段（Final Remark） 参数解析</h4><table><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td><code>GC (CMS Final Remark)</code></td><td>表示是 CMS GC 的 <strong>Final Remark（最终标记）</strong>阶段，STW。用于补充并发标记期间对象引用关系的变化。</td></tr><tr><td><code>[1 CMS-remark: 346752K(393216K)]</code></td><td>老年代中可达对象 <code>346752K</code>，老年代总容量 <code>393216K</code>。这是最终标记完后存活的对象。</td></tr><tr><td><code>360275K(511232K)</code></td><td>整个堆（young + old）占用 <code>360275K</code>，总容量 <code>511232K</code>。</td></tr><tr><td><code>0.0009259 secs</code></td><td>本次 Final Remark 总耗时不到 1ms，表现极好。</td></tr></tbody></table><h4 id="子阶段"><a href="#子阶段" class="headerlink" title="子阶段"></a>子阶段</h4><table><thead><tr><th>子阶段</th><th>说明</th></tr></thead><tbody><tr><td>YG occupancy: 13523 K (118016 K)</td><td>年轻代使用情况：共 <code>118016K</code>，已使用 <code>13523K</code>，剩余大约 <code>104493K</code>。</td></tr><tr><td>[Rescan (parallel), 0.0004817 secs]</td><td><code>Rescan</code> 多线程重新标记 CMS Root Set 中的引用变化（避免误判 GC Roots）。 耗时不到 0.5ms，说明对象变化较少，GC Root 数量不大。</td></tr><tr><td><code>weak refs processing, 0.0000105 secs</code></td><td>清理 <code>WeakReference</code> 等引用对象。耗时非常短，说明弱引用数量很少。</td></tr><tr><td><code>class unloading, 0.0001355 secs</code></td><td>卸载没有引用的类（class loader）。耗时约 0.13ms，说明当前无大量动态加载&#x2F;卸载行为。</td></tr><tr><td><code>scrub symbol table</code> &#x2F; <code>scrub string table</code></td><td>清理常量池&#x2F;字符串表中已无引用的项。</td></tr></tbody></table><p><strong>CMS流程</strong>：<br>初始标记（STW）→ 并发标记 → 预清理 → 可中止预清理 → 最终标记（STW）→ 并发清除 → 重置。</p><h2 id="关键GC事件分析"><a href="#关键GC事件分析" class="headerlink" title="关键GC事件分析"></a>关键GC事件分析</h2><h3 id="阶段1：快速填充期（0-169s-0-724s）"><a href="#阶段1：快速填充期（0-169s-0-724s）" class="headerlink" title="阶段1：快速填充期（0.169s - 0.724s）"></a>阶段1：快速填充期（0.169s - 0.724s）</h3><p>连续发生Minor GC (ParNew)，对象快速晋升老年代</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0.169s: [ParNew: 104876K-&gt;12778K] 堆: 104876K-&gt;51738K </span><br><span class="line">  → 老年代占用: 51,738K - 12,778K = 38,960K</span><br><span class="line"></span><br><span class="line">0.297s: [ParNew: 116554K-&gt;13050K] 堆: 155514K-&gt;141179K </span><br><span class="line">  → 老年代占用: 141,179K - 13,050K = 128,129K (+89,169K)</span><br><span class="line"></span><br><span class="line">0.724s: [ParNew: 117465K-&gt;12893K] 堆: 370849K-&gt;312796K </span><br><span class="line">  → 老年代占用: 312,796K - 12,893K = 299,903K (已达阈值76.3%)</span><br></pre></td></tr></table></figure><ul><li><strong>5次Minor GC</strong> 后老年代从 0K → <strong>299,903K</strong></li><li>晋升速率：<strong>≈60MB&#x2F;秒</strong></li><li>触发CMS条件：299,903K &gt; 294,912K (75%)</li></ul><h3 id="阶段2：第一次CMS周期（0-742s-0-883s）"><a href="#阶段2：第一次CMS周期（0-742s-0-883s）" class="headerlink" title="阶段2：第一次CMS周期（0.742s - 0.883s）"></a>阶段2：第一次CMS周期（0.742s - 0.883s）</h3><p>并发标记清理，清理后老年代明显下降</p><h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://iluis.cn">Luis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://iluis.cn/e3f46350.html">https://iluis.cn/e3f46350.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://iluis.cn" target="_blank">LuisのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JVM/">JVM</a></div><div class="post_share"><div class="social-share" data-image="/img/luis/t3.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/d5d7710f.html" title="JVM 知识提升"><img class="cover" src="/img/luis/t3.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JVM 知识提升</div></div></a></div><div class="next-post pull-right"><a href="/aefb5c52.html" title="Junit5、Mockito3"><img class="cover" src="/img/luis/t3.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Junit5、Mockito3</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/d5d7710f.html" title="JVM 知识提升"><img class="cover" src="/img/luis/t3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-10</div><div class="title">JVM 知识提升</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/luis/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Luis</div><div class="author-info__description">低头赶路、敬事如仪</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/iluis97"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">微信公众号: dacoder<br> Gitee: https://gitee.com/iluis<br> GitHub: https://github.com/iluis97</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.</span> <span class="toc-text">JVM运行时内存区域</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98"><span class="toc-number">2.</span> <span class="toc-text">堆外内存</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%BC%82%E5%B8%B8"><span class="toc-number">3.</span> <span class="toc-text">常见异常</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#StackOverflowError"><span class="toc-number">3.1.</span> <span class="toc-text">StackOverflowError</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C-%E5%B8%B8%E8%A7%81%E8%A7%A6%E5%8F%91%E5%9C%BA%E6%99%AF"><span class="toc-number">3.1.1.</span> <span class="toc-text">📌 常见触发场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OutOfMemoryError%EF%BC%88OOM%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">OutOfMemoryError（OOM）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%93%8C-%E5%B8%B8%E8%A7%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">📌 常见类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%A7%A6%E5%8F%91%E5%9C%BA%E6%99%AF"><span class="toc-number">3.2.2.</span> <span class="toc-text">常见触发场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.2.3.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A7%E6%80%A5%E5%A4%84%E7%90%86%EF%BC%88%E4%B8%B4%E6%97%B6%EF%BC%89"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">紧急处理（临时）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%9C%AC%E6%80%A7%E4%BF%AE%E5%A4%8D"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">根本性修复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E9%98%B2%E6%8E%AA%E6%96%BD"><span class="toc-number">3.2.4.</span> <span class="toc-text">预防措施</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8A%E6%96%AD%E5%BB%BA%E8%AE%AE"><span class="toc-number">3.3.</span> <span class="toc-text">诊断建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GC%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-number">4.</span> <span class="toc-text">GC收集器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">JVM参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">三种类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%8F%82%E6%95%B0%EF%BC%88-%EF%BC%89"><span class="toc-number">5.1.1.</span> <span class="toc-text">标准参数（-）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E6%A0%87%E5%87%86%E5%8F%82%E6%95%B0%EF%BC%88-X%EF%BC%89"><span class="toc-number">5.1.2.</span> <span class="toc-text">非标准参数（-X）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E5%8F%82%E6%95%B0%EF%BC%88-XX%EF%BC%89"><span class="toc-number">5.1.3.</span> <span class="toc-text">高级参数（-XX）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Boolean%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.3.1.</span> <span class="toc-text">Boolean类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Key-Value%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.3.2.</span> <span class="toc-text">Key-Value类型</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">JVM启动参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E8%AE%BE%E7%BD%AE%EF%BC%88%E6%8E%A7%E5%88%B6%E5%A0%86%E7%BB%93%E6%9E%84%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">堆内存设置（控制堆结构）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GC-%E7%AD%96%E7%95%A5%E4%B8%8E%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0"><span class="toc-number">6.2.</span> <span class="toc-text">GC 策略与相关参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%8A%E6%96%AD%E4%B8%8E%E7%A8%B3%E5%AE%9A%E6%80%A7%E5%8F%82%E6%95%B0"><span class="toc-number">6.3.</span> <span class="toc-text">诊断与稳定性参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JDK8%E5%9C%BA%E6%99%AF"><span class="toc-number">7.</span> <span class="toc-text">JDK8场景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CommandLine-flags"><span class="toc-number">7.1.</span> <span class="toc-text">CommandLine flags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%94%9F%E4%BB%A3GC"><span class="toc-number">7.2.</span> <span class="toc-text">新生代GC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%81%E5%B9%B4%E4%BB%A3GC"><span class="toc-number">7.3.</span> <span class="toc-text">老年代GC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GC-%E7%9A%84-%E5%88%9D%E5%A7%8B%E6%A0%87%E8%AE%B0%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">7.3.1.</span> <span class="toc-text">GC 的 初始标记参数解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GC-%E7%9A%84-%E6%9C%80%E7%BB%88%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5"><span class="toc-number">7.3.2.</span> <span class="toc-text">GC 的 最终标记阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E7%BB%88%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5%EF%BC%88Final-Remark%EF%BC%89-%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-number">7.3.2.1.</span> <span class="toc-text">最终标记阶段（Final Remark） 参数解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%90%E9%98%B6%E6%AE%B5"><span class="toc-number">7.3.2.2.</span> <span class="toc-text">子阶段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AEGC%E4%BA%8B%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-number">7.4.</span> <span class="toc-text">关键GC事件分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B51%EF%BC%9A%E5%BF%AB%E9%80%9F%E5%A1%AB%E5%85%85%E6%9C%9F%EF%BC%880-169s-0-724s%EF%BC%89"><span class="toc-number">7.4.1.</span> <span class="toc-text">阶段1：快速填充期（0.169s - 0.724s）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B52%EF%BC%9A%E7%AC%AC%E4%B8%80%E6%AC%A1CMS%E5%91%A8%E6%9C%9F%EF%BC%880-742s-0-883s%EF%BC%89"><span class="toc-number">7.4.2.</span> <span class="toc-text">阶段2：第一次CMS周期（0.742s - 0.883s）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#END"><span class="toc-number">8.</span> <span class="toc-text">END</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/a2aedf2f.html" title="MySQL 性能优化"><img src="/img/luis/t2.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MySQL 性能优化"></a><div class="content"><a class="title" href="/a2aedf2f.html" title="MySQL 性能优化">MySQL 性能优化</a><time datetime="2025-05-17T02:21:13.000Z" title="发表于 2025-05-17 10:21:13">2025-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/58b301d4.html" title="MySQL 进阶篇"><img src="/img/luis/t7.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MySQL 进阶篇"></a><div class="content"><a class="title" href="/58b301d4.html" title="MySQL 进阶篇">MySQL 进阶篇</a><time datetime="2025-05-16T08:00:13.000Z" title="发表于 2025-05-16 16:00:13">2025-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/7a3baa07.html" title="MySQL 基础篇"><img src="/img/luis/t1.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MySQL 基础篇"></a><div class="content"><a class="title" href="/7a3baa07.html" title="MySQL 基础篇">MySQL 基础篇</a><time datetime="2025-05-15T06:51:13.000Z" title="发表于 2025-05-15 14:51:13">2025-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/d5d7710f.html" title="JVM 知识提升"><img src="/img/luis/t3.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="JVM 知识提升"></a><div class="content"><a class="title" href="/d5d7710f.html" title="JVM 知识提升">JVM 知识提升</a><time datetime="2025-05-10T05:12:02.000Z" title="发表于 2025-05-10 13:12:02">2025-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/e3f46350.html" title="JVM 知识梳理"><img src="/img/luis/t3.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="JVM 知识梳理"></a><div class="content"><a class="title" href="/e3f46350.html" title="JVM 知识梳理">JVM 知识梳理</a><time datetime="2025-05-09T05:12:02.000Z" title="发表于 2025-05-09 13:12:02">2025-05-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/luis/t3.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By Luis</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" src="/js/jquery.slim.min.js"></script><script defer="defer" data-pjax src="/js/cat.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>