<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Junit5、Mockito3 | LuisのBlog</title><meta name="author" content="Luis"><meta name="copyright" content="Luis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Junit5 官方文档: https:&#x2F;&#x2F;junit.org&#x2F;junit5&#x2F;docs&#x2F;current&#x2F;user-guide&#x2F;#overview  什么是 JUnit 5？与以前版本的 JUnit 不同，JUnit 5 由来自三个不同子项目的几个不同模块组成。  JUnit 5 &#x3D; JUnit Platform + JUnit Jupiter + JUnit Vintage  JUnit"><meta property="og:type" content="article"><meta property="og:title" content="Junit5、Mockito3"><meta property="og:url" content="https://iluis.cn/aefb5c52.html"><meta property="og:site_name" content="LuisのBlog"><meta property="og:description" content="Junit5 官方文档: https:&#x2F;&#x2F;junit.org&#x2F;junit5&#x2F;docs&#x2F;current&#x2F;user-guide&#x2F;#overview  什么是 JUnit 5？与以前版本的 JUnit 不同，JUnit 5 由来自三个不同子项目的几个不同模块组成。  JUnit 5 &#x3D; JUnit Platform + JUnit Jupiter + JUnit Vintage  JUnit"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://iluis.cn/img/luis/bg4.jpg"><meta property="article:published_time" content="2023-02-03T03:42:14.000Z"><meta property="article:modified_time" content="2025-06-08T01:12:53.181Z"><meta property="article:author" content="Luis"><meta property="article:tag" content="junit-mockito"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://iluis.cn/img/luis/bg4.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://iluis.cn/aefb5c52.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":300},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Luis","link":"链接: ","source":"来源: LuisのBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}
</script><div id="myscoll"></div><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Junit5、Mockito3",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-06-08 09:12:53"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/cat.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/luis/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/luis/bg4.jpg)"><nav id="nav"><span id="blog-info"><a href="/" title="LuisのBlog"><span class="site-name">LuisのBlog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Junit5、Mockito3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-03T03:42:14.000Z" title="发表于 2023-02-03 11:42:14">2023-02-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-08T01:12:53.181Z" title="更新于 2025-06-08 09:12:53">2025-06-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">单元测试</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Junit5、Mockito3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Junit5"><a href="#Junit5" class="headerlink" title="Junit5"></a>Junit5</h1><blockquote><p>官方文档: <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#overview">https://junit.org/junit5/docs/current/user-guide/#overview</a></p></blockquote><h2 id="什么是-JUnit-5？"><a href="#什么是-JUnit-5？" class="headerlink" title="什么是 JUnit 5？"></a>什么是 JUnit 5？</h2><p>与以前版本的 JUnit 不同，JUnit 5 由来自三个不同子项目的几个不同模块组成。</p><blockquote><p>JUnit 5 &#x3D; JUnit Platform + JUnit Jupiter + JUnit Vintage</p></blockquote><p>JUnit 平台作为在 JVM 上启动测试框架的基础。它还定义了TestEngine用于开发在平台上运行的测试框架的 API。此外，该平台提供了一个<br>控制台启动器以从命令行启动平台，并提供JUnit 平台套件引擎以使用平台上的一个或多个测试引擎运行自定义测试套件。流行的<br>IDE（参见IntelliJ IDEA、 Eclipse、NetBeans和 Visual Studio Code）和构建工具（参见Gradle、 Maven和蚂蚁）。</p><p>JUnit Jupiter是用于在 JUnit 5 中编写测试和扩展的编程模型和 扩展模型的组合。Jupiter 子项目提供了一个TestEngine用于在平台上运行基于<br>Jupiter 的测试。</p><p>JUnit Vintage提供了一个TestEngine用于在平台上运行基于 JUnit 3 和 JUnit 4 的测试。它需要 JUnit 4.12 或更高版本出现在类路径或模块路径上。</p><h3 id="支持的-Java-版本"><a href="#支持的-Java-版本" class="headerlink" title="支持的 Java 版本"></a>支持的 Java 版本</h3><p>JUnit 5 在运行时需要 Java 8（或更高版本）。但是，您仍然可以测试使用以前版本的 JDK 编译的代码。</p><hr><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>JUnit Jupiter 支持以下用于配置测试和扩展框架的注解。</p><p>除非另有说明，否则所有核心注释都位于模块中的<code>org.junit.jupiter.api</code>包中<code>junit-jupiter-api</code>。</p><table><thead><tr><th align="left">注解</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><code>@Test</code></td><td align="left">表示方法是测试方法。与 JUnit 4 的<code>@Test</code>注释不同，此注释不声明任何属性，因为 JUnit Jupiter 中的测试扩展基于它们自己的专用注释进行操作。此类方法将被<em>继承</em>，除非它们被<em>覆盖</em>。</td></tr><tr><td align="left"><code>@ParameterizedTest</code></td><td align="left">表示方法是<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests">参数化测试</a>。此类方法将被<em>继承</em>，除非它们被<em>覆盖</em>。</td></tr><tr><td align="left"><code>@RepeatedTest</code></td><td align="left">表示方法是<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-repeated-tests">重复测试</a>的测试模板。此类方法将被<em>继承</em>，除非它们被<em>覆盖</em>。</td></tr><tr><td align="left"><code>@TestFactory</code></td><td align="left">表示方法是<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-dynamic-tests">动态测试</a>的测试工厂。此类方法将被<em>继承</em>，除非它们被<em>覆盖</em>。</td></tr><tr><td align="left"><code>@TestTemplate</code></td><td align="left">表示方法是<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-templates">测试用例的模板，设计用于根据注册</a><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#extensions-test-templates">提供者</a>返回的调用上下文的数量多次调用。此类方法将被<em>继承</em>，除非它们被<em>覆盖</em>。</td></tr><tr><td align="left"><code>@TestClassOrder</code></td><td align="left">用于配置注解测试类中测试类的<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-execution-order-classes">测试类执行顺序。</a><code>@Nested</code>这样的注解是<em>继承</em>的。</td></tr><tr><td align="left"><code>@TestMethodOrder</code></td><td align="left">用于配置注解测试类的<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-execution-order-methods">测试方法执行顺序</a>；类似于 JUnit 4 的<code>@FixMethodOrder</code>. 这样的注解是<em>继承</em>的。</td></tr><tr><td align="left"><code>@TestInstance</code></td><td align="left">用于为带注释的测试类配置<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">测试实例生命周期。</a>这样的注解是<em>继承</em>的。</td></tr><tr><td align="left"><code>@DisplayName</code></td><td align="left">声明测试类或测试方法的自定义<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-display-names">显示名称。</a>此类注释不会被<em>继承</em>。</td></tr><tr><td align="left"><code>@DisplayNameGeneration</code></td><td align="left">为测试类声明自定义<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-display-name-generator">显示名称生成器。</a>这样的注解是<em>继承</em>的。</td></tr><tr><td align="left"><code>@BeforeEach</code></td><td align="left">表示被注解的方法应该在当前类中的<strong>每个</strong>, , , 或方法<em>之前执行；</em> 类似于 JUnit 4 的. 此类方法是<em>继承</em>的——除非它们被<em>覆盖</em>或<em>取代</em>（即，仅根据签名进行替换，而不考虑 Java 的可见性规则）。 <code>@Test``@RepeatedTest``@ParameterizedTest``@TestFactory``@Before</code></td></tr><tr><td align="left"><code>@AfterEach</code></td><td align="left">表示被注解的方法应该在当前类中的<strong>每个</strong>, , , 或方法<em>之后执行；</em> 类似于 JUnit 4 的. 此类方法是<em>继承</em>的——除非它们被<em>覆盖</em>或<em>取代</em>（即，仅根据签名进行替换，而不考虑 Java 的可见性规则）。 <code>@Test``@RepeatedTest``@ParameterizedTest``@TestFactory``@After</code></td></tr><tr><td align="left"><code>@BeforeAll</code></td><td align="left">表示被注解的方法应该在当前类中的<strong>所有</strong>, , , 和方法<em>之前执行；</em> 类似于 JUnit 4 的. 此类方法是<em>继承</em>的——除非它们被<em>隐藏</em>、<em>覆盖</em>或<em>取代</em>（即，仅基于签名替换，而不考虑 Java 的可见性规则）——并且必须是，除非使用“每类”<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">测试实例生命周期</a>。 <code>@Test``@RepeatedTest``@ParameterizedTest``@TestFactory``@BeforeClass``static</code></td></tr><tr><td align="left"><code>@AfterAll</code></td><td align="left">表示被注解的方法应该在当前类中的<strong>所有</strong>, , , 和方法<em>之后执行；</em> 类似于 JUnit 4 的. 此类方法是<em>继承</em>的——除非它们被<em>隐藏</em>、<em>覆盖</em>或<em>取代</em>（即，仅基于签名替换，而不考虑 Java 的可见性规则）——并且必须是，除非使用“每类”<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">测试实例生命周期</a>。 <code>@Test``@RepeatedTest``@ParameterizedTest``@TestFactory``@AfterClass``static</code></td></tr><tr><td align="left"><code>@Nested</code></td><td align="left">表示被注释的类是一个非静态的<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-nested">嵌套测试类</a>。在 Java 8 到 Java 15 中，<code>@BeforeAll</code>除非使用“每类”<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">测试实例生命周期</a><code>@AfterAll</code>，否则不能直接在测试类中使用方法。从 Java 16 开始，可以使用任一测试实例生命周期模式在测试类中声明方法。此类注释不会被<em>继承</em>。<code>@Nested``@BeforeAll``@AfterAll``static``@Nested</code></td></tr><tr><td align="left"><code>@Tag</code></td><td align="left">用于在类或方法级别声明<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering">过滤测试的标签；</a>类似于 TestNG 中的测试组或 JUnit 4 中的类别。此类注释在类级别<em>继承</em>，但不在方法级别继承。</td></tr><tr><td align="left"><code>@Disabled</code></td><td align="left">用于<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-disabling">禁用</a>测试类或测试方法；类似于 JUnit 4 的<code>@Ignore</code>. 此类注释不会被<em>继承</em>。</td></tr><tr><td align="left"><code>@Timeout</code></td><td align="left">如果测试、测试工厂、测试模板或生命周期方法的执行超过给定持续时间，则用于使测试、测试工厂、测试模板或生命周期方法失败。这样的注解是<em>继承</em>的。</td></tr><tr><td align="left"><code>@ExtendWith</code></td><td align="left">用于以<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration-declarative">声明方式注册扩展</a>。这样的注解是<em>继承</em>的。</td></tr><tr><td align="left"><code>@RegisterExtension</code></td><td align="left">用于通过字段以<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#extensions-registration-programmatic">编程方式注册扩展。</a>这些字段是<em>继承</em>的，除非它们被<em>隐藏</em>。</td></tr><tr><td align="left"><code>@TempDir</code></td><td align="left">用于在生命周期方法或测试方法中通过字段注入或参数注入提供<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-built-in-extensions-TempDirectory">临时目录；</a>位于<code>org.junit.jupiter.api.io</code>包中。</td></tr></tbody></table><p>代码演示</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.fail;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StandardTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initAll</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">succeedingTest</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">failingTest</span><span class="params">()</span> &#123;</span><br><span class="line">        fail(<span class="string">&quot;a failing test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Disabled(&quot;for demonstration purposes&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">skippedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// not executed</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">abortedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 假设为真</span></span><br><span class="line">        assumeTrue(<span class="string">&quot;abc&quot;</span>.contains(<span class="string">&quot;Z&quot;</span>));</span><br><span class="line">        fail(<span class="string">&quot;test should have been aborted&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">tearDownAll</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="测试类和方法"><a href="#测试类和方法" class="headerlink" title="测试类和方法"></a>测试类和方法</h2><p>测试方法和生命周期方法可以在当前测试类中本地声明、从超类继承或从接口继承（请参阅 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-interfaces-and-default-methods">测试接口和默认方法</a><br>）。此外，测试方法和生命周期方法不得<code>abstract</code>也不得返回值（<code>@TestFactory</code> 需要返回值的方法除外）。</p><ul><li><p>类和方法可见性测试类、测试方法和生命周期方法不需要是<code>public</code>，但它们<em>不能</em>是<code>private</code>。</p></li><li><p>通常建议省略<code>public</code><br>测试类、测试方法和生命周期方法的修饰符，除非有这样做的技术原因——例如，当一个测试类被另一个包中的测试类扩展时。创建类和方法的另一个技术原因<code>public</code><br>是在使用 Java 模块系统时简化模块路径上的测试。</p></li></ul><p>下面的测试类演示了<code>@Test</code><br>方法的使用和所有支持的生命周期方法。有关运行时语义的更多信息，请参阅 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-execution-order">测试执行顺序</a><br>和 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#extensions-execution-order-wrapping-behavior">回调的包装行为</a>。</p><p>一个标准的测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.fail;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T1_StandardTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initAll</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">succeedingTest</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">failingTest</span><span class="params">()</span> &#123;</span><br><span class="line">        fail(<span class="string">&quot;a failing test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Disabled(&quot;for demonstration purposes&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">skippedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// not executed</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">abortedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 假设为真</span></span><br><span class="line">        assumeTrue(<span class="string">&quot;abc&quot;</span>.contains(<span class="string">&quot;Z&quot;</span>));</span><br><span class="line">        fail(<span class="string">&quot;test should have been aborted&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">tearDownAll</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="显示名称"><a href="#显示名称" class="headerlink" title="显示名称"></a>显示名称</h2><p>测试类和测试方法可以通过<code>@DisplayName</code>空格、特殊字符甚至表情符号来声明自定义显示名称，这些名称将显示在测试报告中以及由测试运行程序和<br>IDE 显示。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DisplayName(&quot;A special test case&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T2_DisplayNameDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Custom test name containing spaces&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithDisplayNameContainingSpaces</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;╯°□°）╯&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithDisplayNameContainingSpecialCharacters</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;😱&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithDisplayNameContainingEmoji</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h2><p>JUnit Jupiter 附带了许多 JUnit 4 拥有的断言方法，并添加了一些非常适合与 Java 8 lambda 一起使用的断言方法。所有 JUnit<br>Jupiter 断言都是类中的<code>static</code>方法<code>org.junit.jupiter.api.Assertions</code>。</p><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a / b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subtract</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a - b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>断言</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.luis.domain.Calculator;</span><br><span class="line"><span class="keyword">import</span> cn.luis.domain.Person;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.Duration.ofMillis;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.time.Duration.ofMinutes;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T3_AssertionsDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Jane&quot;</span>, <span class="string">&quot;Doe&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">standardAssertions</span><span class="params">()</span> &#123;</span><br><span class="line">    assertEquals(<span class="number">2</span>, calculator.add(<span class="number">1</span>, <span class="number">1</span>));</span><br><span class="line">    assertEquals(<span class="number">4</span>, calculator.multiply(<span class="number">2</span>, <span class="number">2</span>), <span class="string">&quot;不相等&quot;</span>);</span><br><span class="line">    assertTrue(<span class="string">&#x27;a&#x27;</span> &lt; <span class="string">&#x27;b&#x27;</span>, () -&gt; <span class="string">&quot;延迟计算&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">groupedAssertions</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 在分组断言中，将执行所有断言，并将一起报告所有故障。</span></span><br><span class="line">    assertAll(<span class="string">&quot;person&quot;</span>,</span><br><span class="line">            () -&gt; assertEquals(<span class="string">&quot;Jane&quot;</span>, person.getFirstName()),</span><br><span class="line">            () -&gt; assertEquals(<span class="string">&quot;Doe&quot;</span>, person.getLastName())</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">dependentAssertions</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 在代码块中，如果断言失败，将跳过同一块中的后续代码。</span></span><br><span class="line">    assertAll(<span class="string">&quot;properties&quot;</span>,</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="type">String</span> <span class="variable">firstName</span> <span class="operator">=</span> person.getFirstName();</span><br><span class="line">              assertNotNull(firstName);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 仅当上一个断言有效时才执行。</span></span><br><span class="line">              assertAll(<span class="string">&quot;first name&quot;</span>,</span><br><span class="line">                      () -&gt; assertTrue(firstName.startsWith(<span class="string">&quot;J&quot;</span>)),</span><br><span class="line">                      () -&gt; assertTrue(firstName.endsWith(<span class="string">&quot;e&quot;</span>))</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="comment">// 分组断言，因此独立于名字断言的结果进行处理。</span></span><br><span class="line">              <span class="type">String</span> <span class="variable">lastName</span> <span class="operator">=</span> person.getLastName();</span><br><span class="line">              assertNotNull(lastName);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// Executed only if the previous assertion is valid.</span></span><br><span class="line">              assertAll(<span class="string">&quot;last name&quot;</span>,</span><br><span class="line">                      () -&gt; assertTrue(lastName.startsWith(<span class="string">&quot;D&quot;</span>)),</span><br><span class="line">                      () -&gt; assertTrue(lastName.endsWith(<span class="string">&quot;e&quot;</span>))</span><br><span class="line">              );</span><br><span class="line">            &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">exceptionTesting</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Exception</span> <span class="variable">exception</span> <span class="operator">=</span> assertThrows(ArithmeticException.class, () -&gt;</span><br><span class="line">            calculator.divide(<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line">    assertEquals(<span class="string">&quot;/ by zero&quot;</span>, exception.getMessage());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">timeoutNotExceeded</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// T以下断言成功。</span></span><br><span class="line">    assertTimeout(ofMinutes(<span class="number">2</span>), () -&gt; &#123;</span><br><span class="line">      <span class="comment">// 执行耗时不到 2 分钟的任务。</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">timeoutNotExceededWithResult</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 以下断言成功，并返回提供的对象。</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">actualResult</span> <span class="operator">=</span> assertTimeout(ofMinutes(<span class="number">2</span>), () -&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;a result&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    assertEquals(<span class="string">&quot;a result&quot;</span>, actualResult);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">timeoutNotExceededWithMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 以下断言调用方法引用并返回一个对象。</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">actualGreeting</span> <span class="operator">=</span> assertTimeout(ofMinutes(<span class="number">2</span>), T3_AssertionsDemo::greeting);</span><br><span class="line">    assertEquals(<span class="string">&quot;Hello, World!&quot;</span>, actualGreeting);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">timeoutExceeded</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// The following assertion fails with an error message similar to:</span></span><br><span class="line">    <span class="comment">// execution exceeded timeout of 10 ms by 91 ms</span></span><br><span class="line">    assertTimeout(ofMillis(<span class="number">10</span>), () -&gt; &#123;</span><br><span class="line">      <span class="comment">// Simulate task that takes more than 10 ms.</span></span><br><span class="line">      Thread.sleep(<span class="number">100</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">timeoutExceededWithPreemptiveTermination</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// The following assertion fails with an error message similar to:</span></span><br><span class="line">    <span class="comment">// execution timed out after 10 ms</span></span><br><span class="line">    assertTimeoutPreemptively(ofMillis(<span class="number">10</span>), () -&gt; &#123;</span><br><span class="line">      <span class="comment">// Simulate task that takes more than 10 ms.</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">1</span>).await();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">greeting</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">assertWithHamcrestMatcher</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 第三方断言库 hamcrest</span></span><br><span class="line">    assertThat(calculator.subtract(<span class="number">4</span>, <span class="number">1</span>), is(equalTo(<span class="number">3</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第三方断言库"><a href="#第三方断言库" class="headerlink" title="第三方断言库"></a>第三方断言库</h3><p>尽管 JUnit Jupiter 提供的断言工具足以满足许多测试场景，但有时仍 需要或需要更强大的功能和附加功能，例如<em>匹配器。</em><br>在这种情况下，JUnit<br>团队建议使用第三方断言库，如<a target="_blank" rel="noopener" href="https://joel-costigliola.github.io/assertj/">AssertJ</a>、<a target="_blank" rel="noopener" href="https://hamcrest.org/JavaHamcrest/">Hamcrest</a>、<a target="_blank" rel="noopener" href="https://truth.dev/">Truth</a><br>等。开发人员因此可以自由选择使用他们选择的断言库。</p><p>例如，<em>匹配器</em>和流畅的 API 的组合可用于使断言更具描述性和可读性。但是，JUnit Jupiter 的<code>org.junit.jupiter.api.Assertions</code><br>类没有提供 <a target="_blank" rel="noopener" href="https://junit.org/junit4/javadoc/latest/org/junit/Assert.html#assertThat"><code>assertThat()</code></a> 像 JUnit<br>4<code>org.junit.Assert</code>类中接受 Hamcrest<br>的方法<a target="_blank" rel="noopener" href="https://junit.org/junit4/javadoc/latest/org/hamcrest/Matcher.html"><code>Matcher</code></a>。相反，鼓励开发人员使用第三方断言库提供的对匹配器的内置支持。</p><hr><h2 id="假设"><a href="#假设" class="headerlink" title="假设"></a>假设</h2><p>JUnit Jupiter 附带了 JUnit 4 提供的假设方法的一个子集，并添加了一些非常适合与 Java 8 lambda 表达式和方法引用一起使用的方法。所有<br>JUnit Jupiter 假设都是 <code>org.junit.jupiter.api.Assumptions</code>类中的静态方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.luis.domain.Calculator;</span><br><span class="line"><span class="keyword">import</span> cn.luis.domain.Person;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumingThat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * assumeTrue:如果表达式的计算结果为false，则test将暂停并变为 已忽略，表示该测试不应运行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T4_AssumptionsDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Jane&quot;</span>, <span class="string">&quot;Doe&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">testOnlyOnCiServer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// true</span></span><br><span class="line">    assumeTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName()));</span><br><span class="line">    <span class="comment">// 测试的其余部分</span></span><br><span class="line">    assertEquals(<span class="number">2</span>, calculator.divide(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">testOnlyOnDeveloperWorkstation</span><span class="params">()</span> &#123;</span><br><span class="line">    assumeTrue(<span class="string">&quot;DEV&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)),</span><br><span class="line">            () -&gt; <span class="string">&quot;中止测试：不在开发人员工作站上&quot;</span>);</span><br><span class="line">    <span class="comment">// 测试的其余部分</span></span><br><span class="line">    assertEquals(<span class="number">2</span>, calculator.divide(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">testInAllEnvironments</span><span class="params">()</span> &#123;</span><br><span class="line">    assumingThat(<span class="string">&quot;CI&quot;</span>.equals(System.getenv(<span class="string">&quot;ENV&quot;</span>)),</span><br><span class="line">            () -&gt; &#123;</span><br><span class="line">              <span class="comment">// 仅在 CI 服务器上执行这些断言</span></span><br><span class="line">              assertEquals(<span class="number">2</span>, calculator.divide(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在所有环境中执行这些断言</span></span><br><span class="line">    assertEquals(<span class="number">42</span>, calculator.multiply(<span class="number">6</span>, <span class="number">7</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="禁用测试"><a href="#禁用测试" class="headerlink" title="禁用测试"></a>禁用测试</h2><p>可以通过<br><em>注解、</em><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-conditional-execution">条件测试执行</a><code>@Disabled</code><br>中讨论的注解之一<br>或自定义的.<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#extensions-conditions"><code>ExecutionCondition</code></a></p><p>这是一个<code>@Disabled</code>测试类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Disabled;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 运行cn.luis.junit5整个文件夹时，跳过该类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Disabled(&quot;Disabled until bug #99 has been fixed&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T5_1_DisabledClassDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWillBeSkipped</span><span class="params">()</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这是一个包含<code>@Disabled</code>测试方法的测试类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Disabled;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 运行T5_2_DisabledClassDemo类时，跳过Disabled方法</span></span><br><span class="line"><span class="comment"> * 注意：</span></span><br><span class="line"><span class="comment"> * 若<span class="doctag">@Disabled</span>标记该类中有Disabled标记的方法，那么运行该类时，不会跳过有Disabled标记的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// @Disabled</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T5_2_DisabledClassDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Disabled(&quot;Disabled until bug #42 has been resolved&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWillBeSkipped</span><span class="params">()</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWillBeExecuted</span><span class="params">()</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">2</span>, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>若@Disabled标记该类中有Disabled标记的方法，那么运行该类时，不会跳过有Disabled标记的方法。【实测】</p></blockquote><p><code>@Disabled</code>可以在不提供<em>理由</em>的情况下宣布；然而，JUnit<br>团队建议开发人员提供一个简短的解释，说明为什么禁用测试类或测试方法。因此，上面的例子都显示了原因的使用——例如，<code>@Disabled(&quot;Disabled until bug #42 has been resolved&quot;)</code><br>。一些开发团队甚至要求在自动可追溯性等 <em>原因中存在问题跟踪号。</em></p><hr><h2 id="嵌套测试"><a href="#嵌套测试" class="headerlink" title="嵌套测试"></a>嵌套测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DisplayName;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Nested;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.EmptyStackException;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 嵌套测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;A stack&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T6_TestingAStackDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">isInstantiatedWithNew</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createNewStack</span><span class="params">()</span> &#123;</span><br><span class="line">            stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when peeked&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::peek);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Nested</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;after pushing an element&quot;)</span></span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">AfterPushing</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">anElement</span> <span class="operator">=</span> <span class="string">&quot;an element&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@BeforeEach</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">pushAnElement</span><span class="params">()</span> &#123;</span><br><span class="line">                stack.push(anElement);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;it is no longer empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">isNotEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when popped and is empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.pop());</span><br><span class="line">                assertTrue(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Test</span></span><br><span class="line">            <span class="meta">@DisplayName(&quot;returns the element when peeked but remains not empty&quot;)</span></span><br><span class="line">            <span class="keyword">void</span> <span class="title function_">returnElementWhenPeeked</span><span class="params">()</span> &#123;</span><br><span class="line">                assertEquals(anElement, stack.peek());</span><br><span class="line">                assertFalse(stack.isEmpty());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在此示例中，通过为设置代码定义分层生命周期方法，将来自外部测试的先决条件用于内部测试。例如，<code>createNewStack()</code><br>是一个 <code>@BeforeEach</code>生命周期方法，它在定义它的测试类中以及在定义它的类下面的嵌套树中的所有级别中使用。</p><p>外部测试的设置代码在内部测试执行之前运行这一事实使您能够独立运行所有测试。您甚至可以单独运行内部测试而不运行外部测试，因为始终会执行外部测试的设置代码。</p><p><em>只有非静态嵌套类</em>（即<em>内部类</em>）可以作为<code>@Nested</code>测试类。嵌套可以任意深，并且这些内部类受到完整的生命周期支持，但有一个例外：<br><em>默认情况下</em><code>@BeforeAll</code>方法<code>@AfterAll</code>不起作用。原因是 Java 不允许在 Java 16<br>之前的内部类中使用成员。但是，可以通过使用（请参阅 <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle">测试实例生命周期</a><br>）注释测试类来规避此限制。如果您使用的是 Java 16 或更高版本，<br>并且可以在测试类中声明方法，则此限制不再适用。 <code>static``@Nested``@TestInstance(Lifecycle.PER_CLASS)``@BeforeAll``@AfterAll``static``@Nested</code></p><h2 id="反复测试"><a href="#反复测试" class="headerlink" title="反复测试"></a>反复测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Luis</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T7_RepeatDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">beforeEach</span><span class="params">(TestInfo testInfo, RepetitionInfo repetitionInfo)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">currentRepetition</span> <span class="operator">=</span> repetitionInfo.getCurrentRepetition();</span><br><span class="line">        <span class="type">int</span> <span class="variable">totalRepetitions</span> <span class="operator">=</span> repetitionInfo.getTotalRepetitions();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> testInfo.getTestMethod().get().getName();</span><br><span class="line">        <span class="comment">// should use log instead</span></span><br><span class="line">        System.out.println(String.format(<span class="string">&quot;About to execute repetition %d of %d for %s&quot;</span>,</span><br><span class="line">                currentRepetition, totalRepetitions, methodName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RepeatedTest(3)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">repeatedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RepeatedTest(5)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">repeatedTestWithRepetitionInfo</span><span class="params">(RepetitionInfo repetitionInfo)</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">5</span>, repetitionInfo.getTotalRepetitions());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RepeatedTest(value = 1, name = &quot;&#123;displayName&#125; &#123;currentRepetition&#125;/&#123;totalRepetitions&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Repeat!&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">customDisplayName</span><span class="params">(TestInfo testInfo)</span> &#123;</span><br><span class="line">        assertEquals(<span class="string">&quot;Repeat! 1/1&quot;</span>, testInfo.getDisplayName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RepeatedTest(value = 1, name = RepeatedTest.LONG_DISPLAY_NAME)</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;Details...&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">customDisplayNameWithLongPattern</span><span class="params">(TestInfo testInfo)</span> &#123;</span><br><span class="line">        assertEquals(<span class="string">&quot;Details... :: repetition 1 of 1&quot;</span>, testInfo.getDisplayName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RepeatedTest(value = 5, name = &quot;luis &#123;currentRepetition&#125; von &#123;totalRepetitions&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">repeatedTestInGerman</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>除了指定重复次数外，还可以通过 注释的<code>name</code>属性为每次重复配置自定义显示名称。<code>@RepeatedTest</code><br>此外，显示名称可以是由静态文本和动态占位符组合而成的模式。当前支持以下占位符。</p><ul><li><code>&#123;displayName&#125;``@RepeatedTest</code>:方法的显示名称</li><li><code>&#123;currentRepetition&#125;</code>: 当前重复次数</li><li><code>&#123;totalRepetitions&#125;</code>：总重复次数</li></ul><p>给定重复的默认显示名称是根据以下模式生成的：<code>&quot;repetition &#123;currentRepetition&#125; of &#123;totalRepetitions&#125;&quot;</code>.<br>因此，上一个示例的单个重复的显示名称<code>repeatedTest()</code>将是： <code>repetition 1 of 10</code>、<code>repetition 2 of 10</code><br>等。如果您希望<code>@RepeatedTest</code><br>方法的显示名称包含在每个重复的名称中，您可以定义自己的自定义模式或使用预定义<code>RepeatedTest.LONG_DISPLAY_NAME</code><br>模式。后者等于<code>&quot;&#123;displayName&#125; :: repetition &#123;currentRepetition&#125; of &#123;totalRepetitions&#125;&quot;</code><br>这会导致单个重复项的显示名称，例如 <code>repeatedTest() :: repetition 1 of 10</code>,<code>repeatedTest() :: repetition 2 of 10</code>等。</p><p>为了以编程方式检索有关当前重复和重复总数的信息，开发人员可以选择将实例 <code>RepetitionInfo</code><br>注入到<code>@RepeatedTest</code>、<code>@BeforeEach</code>或<code>@AfterEach</code>方法中。</p><hr><h2 id="参数化测试"><a href="#参数化测试" class="headerlink" title="参数化测试"></a>参数化测试</h2><p>参数化测试可以使用不同的参数多次运行测试。它们的声明方式与常规<code>@Test</code>方法一样，但使用 <code>@ParameterizedTest</code><br>注解代替。此外，您必须至少声明一个 <em>源</em>，该源将为每次调用提供参数，然后在测试方法中<em>使用这些参数。</em></p><p>为了使用参数化测试，您需要添加对 <code>junit-jupiter-params</code><br>工件的依赖。详情请参考<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#dependency-metadata">依赖元</a>数据。</p><p>以下示例演示了一个参数化测试，该测试使用<code>@ValueSource</code> 注释将<code>String</code>数组指定为参数源。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T8_ParameterizedTestDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ValueSource(strings = &#123;&quot;racecar&quot;, &quot;radar&quot;, &quot;able was I ere I saw elba&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">length</span><span class="params">(String candidate)</span> &#123;</span><br><span class="line">        assertTrue(candidate.length() &gt; <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ValueSource(ints = &#123;1, 2, 3&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithValueSource</span><span class="params">(<span class="type">int</span> argument)</span> &#123;</span><br><span class="line">        assertTrue(argument &gt; <span class="number">0</span> &amp;&amp; argument &lt; <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="空源和空源"><a href="#空源和空源" class="headerlink" title="空源和空源"></a>空源和空源</h3><p>为了检查极端情况并验证我们的软件在提供<em>错误输入时的正确行为，将**空</em>值提供给我们的参数化测试<code>null</code><br>可能很有用。以下注释用作接受单个参数的参数化测试的来源和空值。<code>null</code></p><ul><li><code>@NullSource``null</code>: 为带注释的<code>@ParameterizedTest</code> 方法提供单个参数。<ul><li><code>@NullSource</code>不能用于具有原始类型的参数。</li></ul></li><li><code>@EmptySource</code>: 为以下类型的参数的注释 方法提供单个<em>空</em>参数： , , , ,<br>原始数组（例如，,等），对象数组（例如，,等）。<code>@ParameterizedTest``java.lang.String``java.util.List``java.util.Set``java.util.Map``int[]``char[][]``String[]``Integer[][]</code><ul><li>不支持受支持类型的子类型。</li></ul></li><li><code>@NullAndEmptySource</code>:<em>组合注释</em>，结合了 <code>@NullSource</code>和的功能<code>@EmptySource</code>。</li></ul><p>如果您需要为参数化测试提供多种不同类型的<em>空白</em><br>字符串，您可以使用<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-sources-ValueSource">@ValueSource</a><br>来实现 ——例如，<code>@ValueSource(strings = &#123;&quot; &quot;, &quot; &quot;, &quot;\t&quot;, &quot;\n&quot;&#125;)</code>.</p><p>您还可以组合<code>@NullSource</code>、<code>@EmptySource</code>和<code>@ValueSource</code>来测试更广泛的<code>null</code>、<em>empty</em>和<em>blank</em>输入。以下示例演示了如何为字符串实现此目的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T8_ParameterizedTestDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@NullSource</span></span><br><span class="line">    <span class="meta">@EmptySource</span></span><br><span class="line">    <span class="meta">@ValueSource(strings = &#123;&quot; &quot;, &quot;   &quot;, &quot;\t&quot;, &quot;\n&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">nullEmptyAndBlankStrings</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        assertTrue(text == <span class="literal">null</span> || text.trim().isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数化测试方法的两种变体都会<code>nullEmptyAndBlankStrings(String)</code>导致 6 次调用：1 次用于<code>null</code>，1 次用于空字符串，4 次用于通过<br>提供的显式空白字符串<code>@ValueSource</code>。</p><h3 id="枚举源"><a href="#枚举源" class="headerlink" title="枚举源"></a>枚举源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.ParameterizedTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.temporal.ChronoUnit;</span><br><span class="line"><span class="keyword">import</span> java.time.temporal.TemporalUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.EnumSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.params.provider.Arguments.arguments;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T8_ParameterizedTestDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------枚举源------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@EnumSource(ChronoUnit.class)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithEnumSource</span><span class="params">(TemporalUnit unit)</span> &#123;</span><br><span class="line">        assertNotNull(unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@EnumSource</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithEnumSourceWithAutoDetection</span><span class="params">(ChronoUnit unit)</span> &#123;</span><br><span class="line">        assertNotNull(unit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@EnumSource(names = &#123;&quot;DAYS&quot;, &quot;HOURS&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithEnumSourceInclude</span><span class="params">(ChronoUnit unit)</span> &#123;</span><br><span class="line">        assertTrue(EnumSet.of(ChronoUnit.DAYS, ChronoUnit.HOURS).contains(unit));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该<span class="doctag">@EnumSource</span>注解还提供了一个可选mode属性，可以对哪些常量传递给测试方法进行细粒度控制。</span></span><br><span class="line"><span class="comment">     * 例如，您可以从枚举常量池中排除名称或指定正则表达式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@EnumSource(mode = EnumSource.Mode.EXCLUDE, names = &#123;&quot;ERAS&quot;, &quot;FOREVER&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithEnumSourceExclude</span><span class="params">(ChronoUnit unit)</span> &#123;</span><br><span class="line">        assertFalse(EnumSet.of(ChronoUnit.ERAS, ChronoUnit.FOREVER).contains(unit));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@EnumSource(mode = EnumSource.Mode.MATCH_ALL, names = &quot;^.*DAYS$&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithEnumSourceRegex</span><span class="params">(ChronoUnit unit)</span> &#123;</span><br><span class="line">        assertTrue(unit.name().endsWith(<span class="string">&quot;DAYS&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法源"><a href="#方法源" class="headerlink" title="方法源"></a>方法源</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T8_ParameterizedTestDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------方法源------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;stringProvider&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithExplicitLocalMethodSource</span><span class="params">(String argument)</span> &#123;</span><br><span class="line">        assertNotNull(argument);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">stringProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithDefaultLocalMethodSource</span><span class="params">(String argument)</span> &#123;</span><br><span class="line">        assertNotNull(argument);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">testWithDefaultLocalMethodSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;range&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithRangeMethodSource</span><span class="params">(<span class="type">int</span> argument)</span> &#123;</span><br><span class="line">        assertNotEquals(<span class="number">9</span>, argument);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> IntStream <span class="title function_">range</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> IntStream.range(<span class="number">0</span>, <span class="number">20</span>).skip(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;stringIntAndListProvider&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithMultiArgMethodSource</span><span class="params">(String str, <span class="type">int</span> num, List&lt;String&gt; list)</span> &#123;</span><br><span class="line">        assertEquals(<span class="number">5</span>, str.length());</span><br><span class="line">        assertTrue(num &gt;= <span class="number">1</span> &amp;&amp; num &lt;= <span class="number">2</span>);</span><br><span class="line">        assertEquals(<span class="number">2</span>, list.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Arguments&gt; <span class="title function_">stringIntAndListProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">                arguments(<span class="string">&quot;apple&quot;</span>, <span class="number">1</span>, Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>)),</span><br><span class="line">                arguments(<span class="string">&quot;lemon&quot;</span>, <span class="number">2</span>, Arrays.asList(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以通过提供<em>完全限定的方法名称</em>来引用外部<code>static</code> <em>工厂</em>方法，如以下示例所示。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.ParameterizedTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.MethodSource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExternalMethodSourceDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;cn.luis.junit5.StringsProviders#tinyStrings&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWithExternalMethodSource</span><span class="params">(String tinyString)</span> &#123;</span><br><span class="line">        <span class="comment">// test with tiny string</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringsProviders</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">tinyStrings</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;oo&quot;</span>, <span class="string">&quot;OOO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>方法源参考：<a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-sources-MethodSource">https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-sources-MethodSource</a></p></blockquote><hr><h2 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h2><p><code>@Timeout</code>注释允许人们声明如果测试、测试工厂、测试模板或生命周期方法的执行时间超过给定的持续时间，则该方法应该失败。持续时间的时间单位默认为秒，但可以配置。</p><p>以下示例显示如何<code>@Timeout</code>应用于生命周期和测试方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Timeout;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TimeoutDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="meta">@Timeout(5)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// fails if execution time exceeds 5 seconds</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Timeout(value = 500, unit = TimeUnit.MILLISECONDS)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">failsIfExecutionTimeExceeds500Milliseconds</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// fails if execution time exceeds 500 milliseconds</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果您需要更好地控制轮询间隔并通过异步测试获得更大的灵活性，请考虑使用专用库，例如 Awaitility。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Timeout(5)</span></span><br><span class="line">    <span class="comment">// Poll at most 5 seconds</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pollUntil</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">mockResultTemp</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">while</span> (mockResultTemp) &#123;</span><br><span class="line">            Thread.sleep(<span class="number">250</span>); <span class="comment">// 自定义轮询间隔</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取异步结果并执行断言</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="动态测试"><a href="#动态测试" class="headerlink" title="动态测试"></a>动态测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.luis.junit5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.luis.domain.Calculator;</span><br><span class="line"><span class="keyword">import</span> cn.luis.domain.Person;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DynamicNode;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.DynamicTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.TestFactory;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.function.ThrowingConsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.IntStream;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Stream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.DynamicContainer.dynamicContainer;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.DynamicTest.dynamicTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T9_DynamicTestsDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Jane&quot;</span>, <span class="string">&quot;Doe&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// This will result in a JUnitException!</span></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  List&lt;String&gt; <span class="title function_">dynamicTestsWithInvalidReturnType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Collection&lt;DynamicTest&gt; <span class="title function_">dynamicTestsFromCollection</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(</span><br><span class="line">            dynamicTest(<span class="string">&quot;1st dynamic test&quot;</span>, () -&gt; assertTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName()))),</span><br><span class="line">            dynamicTest(<span class="string">&quot;2nd dynamic test&quot;</span>, () -&gt; assertEquals(<span class="number">4</span>, calculator.multiply(<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Iterable&lt;DynamicTest&gt; <span class="title function_">dynamicTestsFromIterable</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(</span><br><span class="line">            dynamicTest(<span class="string">&quot;3rd dynamic test&quot;</span>, () -&gt; assertTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName()))),</span><br><span class="line">            dynamicTest(<span class="string">&quot;4th dynamic test&quot;</span>, () -&gt; assertEquals(<span class="number">4</span>, calculator.multiply(<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Iterator&lt;DynamicTest&gt; <span class="title function_">dynamicTestsFromIterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Arrays.asList(</span><br><span class="line">            dynamicTest(<span class="string">&quot;5th dynamic test&quot;</span>, () -&gt; assertTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName()))),</span><br><span class="line">            dynamicTest(<span class="string">&quot;6th dynamic test&quot;</span>, () -&gt; assertEquals(<span class="number">4</span>, calculator.multiply(<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">    ).iterator();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  DynamicTest[] dynamicTestsFromArray() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DynamicTest</span>[]&#123;</span><br><span class="line">            dynamicTest(<span class="string">&quot;7th dynamic test&quot;</span>, () -&gt; assertTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName()))),</span><br><span class="line">            dynamicTest(<span class="string">&quot;8th dynamic test&quot;</span>, () -&gt; assertEquals(<span class="number">4</span>, calculator.multiply(<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Stream&lt;DynamicTest&gt; <span class="title function_">dynamicTestsFromStream</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(<span class="string">&quot;racecar&quot;</span>, <span class="string">&quot;radar&quot;</span>, <span class="string">&quot;mom&quot;</span>, <span class="string">&quot;dad&quot;</span>)</span><br><span class="line">            .map(text -&gt; dynamicTest(text, () -&gt; assertTrue(text.length() &gt; <span class="number">5</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Stream&lt;DynamicTest&gt; <span class="title function_">dynamicTestsFromIntStream</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Generates tests for the first 10 even integers.</span></span><br><span class="line">    <span class="keyword">return</span> IntStream.iterate(<span class="number">0</span>, n -&gt; n + <span class="number">2</span>).limit(<span class="number">10</span>)</span><br><span class="line">            .mapToObj(n -&gt; dynamicTest(<span class="string">&quot;test&quot;</span> + n, () -&gt; assertTrue(n % <span class="number">2</span> == <span class="number">0</span>)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Stream&lt;DynamicTest&gt; <span class="title function_">generateRandomNumberOfTestsFromIterator</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Generates random positive integers between 0 and 100 until</span></span><br><span class="line">    <span class="comment">// a number evenly divisible by 7 is encountered.</span></span><br><span class="line">    Iterator&lt;Integer&gt; inputGenerator = <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">      <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">      <span class="type">int</span> current;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        current = random.nextInt(<span class="number">100</span>);</span><br><span class="line">        <span class="keyword">return</span> current % <span class="number">7</span> != <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> current;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Generates display names like: input:5, input:37, input:85, etc.</span></span><br><span class="line">    Function&lt;Integer, String&gt; displayNameGenerator = (input) -&gt; <span class="string">&quot;input:&quot;</span> + input;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Executes tests based on the current input value.</span></span><br><span class="line">    ThrowingConsumer&lt;Integer&gt; testExecutor = (input) -&gt; assertTrue(input % <span class="number">7</span> != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Returns a stream of dynamic tests.</span></span><br><span class="line">    <span class="keyword">return</span> DynamicTest.stream(inputGenerator, displayNameGenerator, testExecutor);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  Stream&lt;DynamicNode&gt; <span class="title function_">dynamicTestsWithContainers</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>)</span><br><span class="line">            .map(input -&gt; dynamicContainer(<span class="string">&quot;Container &quot;</span> + input, Stream.of(</span><br><span class="line">                    dynamicTest(<span class="string">&quot;not null&quot;</span>, () -&gt; assertNotNull(input)),</span><br><span class="line">                    dynamicContainer(<span class="string">&quot;properties&quot;</span>, Stream.of(</span><br><span class="line">                            dynamicTest(<span class="string">&quot;length &gt; 0&quot;</span>, () -&gt; assertTrue(input.length() &gt; <span class="number">0</span>)),</span><br><span class="line">                            dynamicTest(<span class="string">&quot;not empty&quot;</span>, () -&gt; assertFalse(input.isEmpty()))</span><br><span class="line">                    ))</span><br><span class="line">            )));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  DynamicNode <span class="title function_">dynamicNodeSingleTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dynamicTest(<span class="string">&quot;name check&quot;</span>, () -&gt; assertTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName())));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@TestFactory</span></span><br><span class="line">  DynamicNode <span class="title function_">dynamicNodeSingleContainer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> dynamicContainer(<span class="string">&quot;name check&quot;</span>,</span><br><span class="line">            Stream.of(<span class="string">&quot;racecar&quot;</span>, <span class="string">&quot;radar&quot;</span>, <span class="string">&quot;mom&quot;</span>, <span class="string">&quot;dad&quot;</span>)</span><br><span class="line">                    .map(text -&gt; dynamicTest(text, () -&gt; assertTrue(<span class="string">&quot;Jane&quot;</span>.equals(person.getFirstName())))</span><br><span class="line">                    ));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p> <a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-dynamic-tests">动态测试</a></p></blockquote><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>请参阅官方文档</p><ul><li><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-conditional-execution">条件测试执行</a></li><li><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-execution-order">测试执行顺序</a></li><li><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-dependency-injection">构造函数和方法的依赖注册</a></li><li><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-interfaces-and-default-methods">测试接口和默认方法</a></li></ul><h1 id="Mockito3"><a href="#Mockito3" class="headerlink" title="Mockito3"></a>Mockito3</h1><h2 id="基础教程"><a href="#基础教程" class="headerlink" title="基础教程"></a>基础教程</h2><h3 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//mock creation</span></span><br><span class="line">        List&lt;String&gt; mockedList = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//using mock object</span></span><br><span class="line">        mockedList.add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">        mockedList.clear();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//verification</span></span><br><span class="line">        <span class="comment">// 创建后，模拟将记住所有交互。然后您可以有选择地验证您感兴趣的任何交互。</span></span><br><span class="line">        verify(mockedList).add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">        verify(mockedList).clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="存根"><a href="#存根" class="headerlink" title="存根"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#stubbing">存根</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//You can mock concrete classes, not just interfaces</span></span><br><span class="line">        LinkedList&lt;String&gt; mockedList = mock(LinkedList.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//stubbing</span></span><br><span class="line">        when(mockedList.get(<span class="number">0</span>)).thenReturn(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">        when(mockedList.get(<span class="number">1</span>)).thenThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// following prints &quot;first&quot;</span></span><br><span class="line">        System.out.println(mockedList.get(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// following throws runtime exception</span></span><br><span class="line">        assertThrows(RuntimeException.class, () -&gt; mockedList.get(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// null</span></span><br><span class="line">        assertNull(mockedList.get(<span class="number">999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 虽然可以验证存根调用，但通常它只是多余的</span></span><br><span class="line">        <span class="comment">// 如果你的代码关心 get（0） 返回什么，那么其他东西就会中断（通常甚至在 verify（） 被执行之前）。</span></span><br><span class="line">        <span class="comment">// 如果你的代码不关心 get（0） 返回什么，那么它不应该被存根。</span></span><br><span class="line">        verify(mockedList).get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>默认情况下，对于所有返回值的方法，mock 将根据需要返回 null、原始&#x2F;原始包装器值或空集合。例如 0 表示 int&#x2F;Integer，false 表示 boolean&#x2F;Boolean。</li><li>存根可以被覆盖：例如，普通存根可以进入夹具设置，但测试方法可以覆盖它。请注意，覆盖存根是一种潜在的代码味道，它指出存根过多</li><li>一旦存根，该方法将始终返回一个存根值，无论它被调用多少次。</li><li>最后存根更重要 - 当您多次使用相同的参数存入相同的方法时。换句话说：<strong>存根的顺序很重要</strong>，但它很少有意义，例如，当存根完全相同的方法调用时，或者有时在使用参数匹配器时，等等。</li></ul><h3 id="参数匹配器"><a href="#参数匹配器" class="headerlink" title="参数匹配器"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#argument_matchers">参数匹配器</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">parameterMatcher</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; mockedList = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//stubbing using built-in anyInt() argument matcher</span></span><br><span class="line">        when(mockedList.get(anyInt())).thenReturn(<span class="string">&quot;element&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 也可使用自定义匹配器进行存根</span></span><br><span class="line">        <span class="comment">// when(mockedList.contains(argThat(isValid()))).thenReturn(true);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// following  &quot;element&quot;</span></span><br><span class="line">        assertEquals(<span class="string">&quot;element&quot;</span>, mockedList.get(<span class="number">999</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//you can also verify using an argument matcher</span></span><br><span class="line">        verify(mockedList).get(anyInt());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//argument matchers can also be written as Java 8 Lambdas</span></span><br><span class="line">        verify(mockedList).add(argThat(someString -&gt; someString.length() &gt; <span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参数匹配器允许灵活的验证或存根。 查看更多内置匹配器和<strong>自定义参数匹配器&#x2F;hamcrest 匹配器</strong>示例。 <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentMatchers.html"><code>Click here</code></a> <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/hamcrest/MockitoHamcrest.html"><code>or here</code></a></p><p>有关<strong>自定义参数匹配器</strong>的信息，请查看<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentMatcher.html"><code>ArgumentMatcher</code></a>类的 javadoc。</p><p>合理使用复杂的参数匹配。<code>equals()</code>与偶尔的匹配器一起使用的自然匹配风格<code>anyX()</code>往往会提供干净简单的测试。有时重构代码以允许<code>equals()</code>匹配甚至实现<code>equals()</code>方法来帮助测试会更好。</p><p>另外，阅读<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#15">第 15 节</a>或类的 javadoc <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentCaptor.html"><code>ArgumentCaptor</code></a>。 <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentCaptor.html"><code>ArgumentCaptor</code></a>是参数匹配器的特殊实现，它捕获参数值以供进一步断言。</p><p><strong>关于参数匹配器的警告：</strong></p><p>如果您使用参数匹配器，则<strong>所有参数</strong>都必须由匹配器提供。</p><h3 id="验证确切的调用次数-x2F-至少x次-x2F-从不"><a href="#验证确切的调用次数-x2F-至少x次-x2F-从不" class="headerlink" title="验证确切的调用次数&#x2F; 至少x次&#x2F;从不"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#exact_verification">验证确切的调用次数</a>&#x2F; <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#at_least_verification">至少x</a>次&#x2F;从不</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">runTimes</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; mockedList = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用mock</span></span><br><span class="line">        mockedList.add(<span class="string">&quot;once&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mockedList.add(<span class="string">&quot;twice&quot;</span>);</span><br><span class="line">        mockedList.add(<span class="string">&quot;twice&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mockedList.add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">        mockedList.add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">        mockedList.add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面两个验证是等同的 - 默认使用times(1)</span></span><br><span class="line">        verify(mockedList).add(<span class="string">&quot;once&quot;</span>);</span><br><span class="line">        verify(mockedList, times(<span class="number">1</span>)).add(<span class="string">&quot;once&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证精确调用次数</span></span><br><span class="line">        verify(mockedList, times(<span class="number">2</span>)).add(<span class="string">&quot;twice&quot;</span>);</span><br><span class="line">        verify(mockedList, times(<span class="number">3</span>)).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用using never()来验证. never()相当于 times(0)</span></span><br><span class="line">        verify(mockedList, never()).add(<span class="string">&quot;never happened&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用 atLeast()/atMost()来验证</span></span><br><span class="line">        verify(mockedList, atLeastOnce()).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">        verify(mockedList, atLeast(<span class="number">2</span>)).add(<span class="string">&quot;five times&quot;</span>);</span><br><span class="line">        verify(mockedList, atMost(<span class="number">5</span>)).add(<span class="string">&quot;three times&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>times(1) 是默认值。</strong>因此可以省略显式使用 times(1) 。</p><h3 id="对-void-方法进行异常处理"><a href="#对-void-方法进行异常处理" class="headerlink" title="对 void 方法进行异常处理"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#stubbing_with_exceptions">对 void 方法进行异常处理</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">exception</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; mockedList = mock(List.class);</span><br><span class="line"></span><br><span class="line">        doThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>()).when(mockedList).clear();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面会抛出 RuntimeException</span></span><br><span class="line">        mockedList.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="顺序验证"><a href="#顺序验证" class="headerlink" title="顺序验证"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#in_order_verification">顺序验证</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">order</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// A. 单个Mock，方法必须以特定顺序调用</span></span><br><span class="line">        List&lt;String&gt; singleMock = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用单个Mock</span></span><br><span class="line">        singleMock.add(<span class="string">&quot;was added first&quot;</span>);</span><br><span class="line">        singleMock.add(<span class="string">&quot;was added second&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//为singleMock创建 inOrder 检验器</span></span><br><span class="line">        <span class="type">InOrder</span> <span class="variable">singleInOrder</span> <span class="operator">=</span> inOrder(singleMock);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面将确保add方法第一次调用是用&quot;was added first&quot;,然后是用&quot;was added second&quot;</span></span><br><span class="line">        singleInOrder.verify(singleMock).add(<span class="string">&quot;was added first&quot;</span>);</span><br><span class="line">        singleInOrder.verify(singleMock).add(<span class="string">&quot;was added second&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// B. 多个Mock必须以特定顺序调用</span></span><br><span class="line">        List&lt;String&gt; firstMock = mock(List.class);</span><br><span class="line">        List&lt;String&gt; secondMock = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用mock</span></span><br><span class="line">        firstMock.add(<span class="string">&quot;was called first&quot;</span>);</span><br><span class="line">        secondMock.add(<span class="string">&quot;was called second&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建 inOrder 对象，传递任意多个需要验证顺序的mock</span></span><br><span class="line">        <span class="type">InOrder</span> <span class="variable">inOrder</span> <span class="operator">=</span> inOrder(firstMock, secondMock);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面将确保firstMock在secondMock之前调用</span></span><br><span class="line">        inOrder.verify(firstMock).add(<span class="string">&quot;was called first&quot;</span>);</span><br><span class="line">        inOrder.verify(secondMock).add(<span class="string">&quot;was called second&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 另外 A + B 可以任意混合</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="确保交互从未在模拟中发生"><a href="#确保交互从未在模拟中发生" class="headerlink" title="确保交互从未在模拟中发生"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#never_verification">确保交互从未在模拟中发生</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">verifyNever</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; mockOne = mock(List.class);</span><br><span class="line">        List&lt;String&gt; mockTwo = mock(List.class);</span><br><span class="line">        List&lt;String&gt; mockThree = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用mock - 仅有mockOne有交互</span></span><br><span class="line">        mockOne.add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通验证</span></span><br><span class="line">        verify(mockOne).add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证方法从未在mock对象上调用</span></span><br><span class="line">        verify(mockOne, never()).add(<span class="string">&quot;two&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证其他mock没有交互</span></span><br><span class="line">        verifyZeroInteractions(mockTwo, mockThree);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">verifyNo</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; mockedList = mock(List.class);</span><br><span class="line">		<span class="comment">// 确保本身没有交互</span></span><br><span class="line">        verifyNoInteractions(mockedList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查找冗余调用"><a href="#查找冗余调用" class="headerlink" title="查找冗余调用"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#finding_redundant_invocations">查找冗余调用</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">verifyMore</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; mockedList = mock(List.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用mock</span></span><br><span class="line">        mockedList.add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">        mockedList.add(<span class="string">&quot;two&quot;</span>);</span><br><span class="line"></span><br><span class="line">        verify(mockedList).add(<span class="string">&quot;one&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面的验证将会失败，因为未校验mockedList.add(&quot;two&quot;)操作</span></span><br><span class="line">        verifyNoMoreInteractions(mockedList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mocks创建的速记——-Mock注解"><a href="#mocks创建的速记——-Mock注解" class="headerlink" title="mocks创建的速记——@Mock注解"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#mock_annotation">mocks创建的速记——<code>@Mock</code>注解</a></h3><ul><li>最大限度地减少重复的模拟创建代码。</li><li>使测试类更具可读性。</li><li>使验证错误更易于阅读，因为<strong>字段名称</strong> 用于标识模拟。</li></ul><p>注意：</p><p>这需要在基类或测试运行器中的某个地方</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MockitoAnnotations.initMocks(testClass);</span><br></pre></td></tr></table></figure><h3 id="连续调用存根（迭代器式存根）"><a href="#连续调用存根（迭代器式存根）" class="headerlink" title="连续调用存根（迭代器式存根）"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#stubbing_consecutive_calls">连续调用存根</a>（迭代器式存根）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mockThen</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">mockPerson</span> <span class="operator">=</span> mock(Person.class);</span><br><span class="line">        when(mockPerson.fullName())</span><br><span class="line">                .thenThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>())</span><br><span class="line">                .thenReturn(<span class="string">&quot;z3&quot;</span>, <span class="string">&quot;l4&quot;</span>);</span><br><span class="line"></span><br><span class="line">        assertThrows(RuntimeException.class, () -&gt; mockPerson.fullName());</span><br><span class="line">        assertEquals(<span class="string">&quot;z3&quot;</span>, mockPerson.fullName());</span><br><span class="line">        assertEquals(<span class="string">&quot;l4&quot;</span>, mockPerson.fullName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="回调存根"><a href="#回调存根" class="headerlink" title="回调存根"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#answer_stubs">回调存根</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mockAnswer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">mockPerson</span> <span class="operator">=</span> mock(Person.class);</span><br><span class="line"></span><br><span class="line">        when(mockPerson.repeatWords(anyString())).thenAnswer(invocation -&gt; &#123;</span><br><span class="line">            Object[] args = invocation.getArguments();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">mock</span> <span class="operator">=</span> invocation.getMock();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;called with arguments: &quot;</span> + Arrays.toString(args);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面会 &quot;called with arguments: foo&quot;</span></span><br><span class="line">        System.out.println(mockPerson.repeatWords(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="doReturn-doThrow-doAnswer-doNothing-doCallRealMethod-方法族"><a href="#doReturn-doThrow-doAnswer-doNothing-doCallRealMethod-方法族" class="headerlink" title="doReturn()| doThrow()| doAnswer()| doNothing()| doCallRealMethod()方法族"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#do_family_methods_stubs"><code>doReturn()</code>| <code>doThrow()</code>| <code>doAnswer()</code>| <code>doNothing()</code>| <code>doCallRealMethod()</code>方法族</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mockDo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">mockPerson</span> <span class="operator">=</span> mock(Person.class);</span><br><span class="line">        doThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>()).when(mockPerson).say();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//following throws RuntimeException</span></span><br><span class="line">        mockPerson.say();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于任何方法，您 都可以使用<code>doThrow()</code>、<code>doAnswer()</code>、 和来代替相应的调用。这是必要的当你 <code>doNothing()``doReturn()``doCallRealMethod()``when()</code></p><ul><li>存根无效方法</li><li>间谍对象的存根方法（见下文）</li><li>多次对同一个方法进行存根，以在测试过程中更改模拟的行为。</li></ul><p><code>when()</code>但是对于所有存根调用， 您可能更愿意使用这些方法来代替 with 的替代方法。</p><h3 id="监视真实物体"><a href="#监视真实物体" class="headerlink" title="监视真实物体"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#spy">监视真实物体</a></h3><p>您可以创建真实对象的间谍。当您使用间谍时，将调用<strong>真正</strong>的方法（除非方法被存根）。</p><p>应<strong>谨慎且偶尔</strong>使用真正的间谍，例如在处理<strong>第 3 方接口、遗留代码的临时重构</strong>时。</p><p>监视真实对象可以与“部分模拟”概念相关联。 <strong>在发布 1.8 之前</strong>，Mockito 间谍并不是真正的部分模拟。原因是我们认为部分模拟是一种代码味道。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mockSpy</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>();</span><br><span class="line">        List&lt;String&gt; spy = spy(list);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不可能: 真实方法被调用因此spy.get(0) 会抛出IndexOutOfBoundsException (列表现在还是空的)</span></span><br><span class="line">        when(spy.get(<span class="number">0</span>)).thenReturn(<span class="string">&quot;dalian&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 可以使用 doReturn() 来做存根</span></span><br><span class="line">        doReturn(<span class="string">&quot;dalian&quot;</span>).when(spy).get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>Mockito <em><strong>不*<strong>将调用委托给传递的真实实例，而是实际创建它的副本。因此，如果您保留真实实例并与之交互，不要期望间谍知道这些交互及其对真实实例状态的影响。推论是，当一个</strong>*unstubbed**<em>方法被调用</em></strong>在间谍*<strong>但</strong></em>不在真实实例* 上**时，您将看不到对真实实例的任何影响。</li><li>注意 final 方法。Mockito 不会模拟 final 方法，所以底线是：当你监视真实对象时 + 你试图存根 final 方法 &#x3D; 麻烦。此外，您也无法验证这些方法。</li></ol><h3 id="捕获进一步断言的参数（自-1-8-0-起）"><a href="#捕获进一步断言的参数（自-1-8-0-起）" class="headerlink" title="捕获进一步断言的参数（自 1.8.0 起）"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#captors">捕获</a>进一步断言的参数（自 1.8.0 起）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mockArguments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">mockPerson</span> <span class="operator">=</span> mock(Person.class);</span><br><span class="line"></span><br><span class="line">        mockPerson.increase(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        ArgumentCaptor&lt;Integer&gt; argument = ArgumentCaptor.forClass(Integer.class);</span><br><span class="line">        <span class="comment">// argument.capture() 此处默认值 0</span></span><br><span class="line">        verify(mockPerson).increase(argument.capture());</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="number">1</span>, argument.getValue().intValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>警告：</strong>建议将 ArgumentCaptor 与验证一起使用，<strong>但不要</strong>与存根一起使用。将 ArgumentCaptor 与存根一起使用可能会降低测试的可读性，因为捕获器是在断言（又名验证或“然后”）块之外创建的。它还可以减少缺陷定位，因为如果未调用存根方法，则不会捕获任何参数。</p><p>在某种程度上，ArgumentCaptor 与自定义参数匹配器相关（参见<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentMatcher.html"><code>ArgumentMatcher</code></a>类的 javadoc）。这两种技术都可用于确保将某些参数传递给模拟。但是，如果出现以下情况，ArgumentCaptor 可能更适合：</p><ul><li>自定义参数匹配器不太可能被重用</li><li>您只需要它断言参数值即可完成验证</li></ul><p>自定义参数匹配器 via<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentMatcher.html"><code>ArgumentMatcher</code></a>通常更适合存根。</p><h3 id="新注释：-Captor-Spy-InjectMocks-Since-1-8-3"><a href="#新注释：-Captor-Spy-InjectMocks-Since-1-8-3" class="headerlink" title="新注释：@Captor, @Spy, @InjectMocks(Since 1.8.3)"></a>新注释：<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#captor_annotation"><code>@Captor</code></a>, <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#spy_annotation"><code>@Spy</code></a>, <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#injectmocks_annotation"><code>@InjectMocks</code></a>(Since 1.8.3)</h3><p>1.8.3 版带来了新的注解，有时可能会有帮助：</p><ul><li>@<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Captor.html"><code>Captor</code></a>简化创建<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/ArgumentCaptor.html"><code>ArgumentCaptor</code></a> - 当要捕获的参数是一个讨厌的泛型类并且您想避免编译器警告时很有用</li><li>@ <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Spy.html"><code>Spy</code></a>-您可以改用它<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#spy-T-"><code>spy(Object)</code></a>。</li><li>@ <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/InjectMocks.html"><code>InjectMocks</code></a>- 自动将模拟或间谍字段注入测试对象。</li></ul><p>注意 @<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/InjectMocks.html"><code>InjectMocks</code></a>也可以与 @<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Spy.html"><code>Spy</code></a>注解结合使用，这意味着 Mockito 将注入 mocks 到被测的部分 mock 中。这种复杂性是您应该只使用部分模拟作为最后手段的另一个很好的理由。参见关于部分模拟的第 16 点。</p><p>所有新注释都***仅***在 上处理<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/MockitoAnnotations.html#initMocks-java.lang.Object-"><code>MockitoAnnotations.initMocks(Object)</code></a>。就像 @<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mock.html"><code>Mock</code></a>注解一样，您可以使用内置的 runner:<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/junit/MockitoJUnitRunner.html"><code>MockitoJUnitRunner</code></a>或 rule: <a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/junit/MockitoRule.html"><code>MockitoRule</code></a>。</p><h3 id="超时验证（自1-8-5起）"><a href="#超时验证（自1-8-5起）" class="headerlink" title="超时验证（自1.8.5起）"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#verification_timeout">超时验证</a>（自1.8.5起）</h3><p>允许超时验证。它会导致验证等待指定的时间段以进行所需的交互，而不是如果尚未发生则立即失败。可能对在并发条件下进行测试很有用。</p><p>这个特性应该很少使用 - 想出一个更好的方法来测试你的多线程系统。</p><p>尚未实现与 InOrder 验证一起使用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MockitoTest</span> &#123;	</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">mockTimeout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">mock</span> <span class="operator">=</span> mock(Person.class);</span><br><span class="line"></span><br><span class="line">        mock.say();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当 someMethod（） 被调用时不迟于 100 毫秒内通过，当验证满足时立即退出（例如，可能不会等待整整 100 毫秒）</span></span><br><span class="line">        verify(mock, timeout(<span class="number">100</span>)).say();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// above is an alias to</span></span><br><span class="line">        verify(mock, timeout(<span class="number">100</span>).times(<span class="number">1</span>)).say();</span><br><span class="line"></span><br><span class="line">        mock.say();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 一旦 someMethod（） 在 100 毫秒内被调用 2 次，就会通过</span></span><br><span class="line">        verify(mock, timeout(<span class="number">100</span>).times(<span class="number">2</span>)).say();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等效：一旦 someMethod（） 在 100 毫秒内被调用 2 次，这也就会通过</span></span><br><span class="line">        verify(mock, timeout(<span class="number">100</span>).atLeast(<span class="number">2</span>)).say();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="自动实例化-Spies和-InjectMocks构造函数注入优点（自-1-9-0-起）"><a href="#自动实例化-Spies和-InjectMocks构造函数注入优点（自-1-9-0-起）" class="headerlink" title="自动实例化@Spies和 @InjectMocks构造函数注入优点（自 1.9.0 起）"></a><a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#automatic_instantiation">自动实例化<code>@Spies</code>和 <code>@InjectMocks</code></a>构造<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#constructor_injection">函数注入优点</a>（自 1.9.0 起）</h3><p>Mockito 现在将尝试实例化 @<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Spy.html"><code>Spy</code></a>并将<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/InjectMocks.html"><code>InjectMocks</code></a>使用<strong>构造函数</strong>注入、<strong>setter</strong>注入或<strong>字段</strong>注入实例化 @ 字段。</p><p>要利用此功能，您需要使用<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/MockitoAnnotations.html#initMocks-java.lang.Object-"><code>MockitoAnnotations.initMocks(Object)</code></a>,<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/junit/MockitoJUnitRunner.html"><code>MockitoJUnitRunner</code></a> 或<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/junit/MockitoRule.html"><code>MockitoRule</code></a>。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><p><a target="_blank" rel="noopener" href="https://javadoc.io/doc/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#stubbing">Mockito官网文档</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/R4ZKWcB4TMFAiQlnIRqNeQ">阿里是如何进行单元测试培训的</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/R4ZKWcB4TMFAiQlnIRqNeQ">那些年，我们写过的无效单元测试</a></p></li><li><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&mid=2247526734&idx=1&sn=6e5ffa9a635a3da1536a6c5f94a5483c&chksm=e92a5441de5ddd573e4d95494afc6dce2154bc2042b4213e8c31f7c532b0cbd0b1abfd93a593&scene=21#wechat_redirect">Java编程技巧之单元测试用例编写流程</a></p></li><li><p>更改<a target="_blank" rel="noopener" href="https://javadoc.io/static/org.mockito/mockito-core/3.3.3/org/mockito/Mockito.html#defaultreturn">未存根调用的默认返回值</a>（自 1.7 起）</p></li></ul><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="单元测试覆盖率"><a href="#单元测试覆盖率" class="headerlink" title="单元测试覆盖率"></a>单元测试覆盖率</h2><p>常用的单元测试覆盖率指标有：</p><ul><li>行覆盖(Line Coverage)： 用于度量被测代码中每一行执行语句是否都被测试到了。</li><li>分支覆盖(Branch Coverage)： 用于度量被测代码中每一个代码分支是否都被测试到了。</li><li>条件覆盖(Condition Coverage)： 用于度量被测代码的条件中每一个子表达式（true和false）是否都被测试到了。</li><li>路径覆盖(Path Coverage)： 用于度量被测代码中的每一个代码分支组合是否都被测试到了。</li></ul><p>除此之外，还有方法覆盖（Method Coverage）、类覆盖（Class Coverage）等单元测试覆盖率指标。</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://iluis.cn">Luis</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://iluis.cn/aefb5c52.html">https://iluis.cn/aefb5c52.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://iluis.cn" target="_blank">LuisのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/junit-mockito/">junit-mockito</a></div><div class="post_share"><div class="social-share" data-image="/img/luis/bg4.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/e3f46350.html" title="JVM 知识梳理"><img class="cover" src="/img/luis/bg2.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JVM 知识梳理</div></div></a></div><div class="next-post pull-right"><a href="/c24675b4.html" title="MySQL"><img class="cover" src="/img/luis/t2.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/luis/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Luis</div><div class="author-info__description">低头赶路、敬事如仪</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/iluis97"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">微信公众号: dacoder<br> Gitee: https://gitee.com/iluis<br> GitHub: https://github.com/iluis97</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Junit5"><span class="toc-number">1.</span> <span class="toc-text">Junit5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-JUnit-5%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">什么是 JUnit 5？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84-Java-%E7%89%88%E6%9C%AC"><span class="toc-number">1.1.1.</span> <span class="toc-text">支持的 Java 版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">1.2.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">测试类和方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E7%A4%BA%E5%90%8D%E7%A7%B0"><span class="toc-number">1.4.</span> <span class="toc-text">显示名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E8%A8%80"><span class="toc-number">1.5.</span> <span class="toc-text">断言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%96%AD%E8%A8%80%E5%BA%93"><span class="toc-number">1.5.1.</span> <span class="toc-text">第三方断言库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%81%87%E8%AE%BE"><span class="toc-number">1.6.</span> <span class="toc-text">假设</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A6%81%E7%94%A8%E6%B5%8B%E8%AF%95"><span class="toc-number">1.7.</span> <span class="toc-text">禁用测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-number">1.8.</span> <span class="toc-text">嵌套测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%A4%8D%E6%B5%8B%E8%AF%95"><span class="toc-number">1.9.</span> <span class="toc-text">反复测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-number">1.10.</span> <span class="toc-text">参数化测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E6%BA%90%E5%92%8C%E7%A9%BA%E6%BA%90"><span class="toc-number">1.10.1.</span> <span class="toc-text">空源和空源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E6%BA%90"><span class="toc-number">1.10.2.</span> <span class="toc-text">枚举源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E6%BA%90"><span class="toc-number">1.10.3.</span> <span class="toc-text">方法源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B6%85%E6%97%B6"><span class="toc-number">1.11.</span> <span class="toc-text">超时</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B5%8B%E8%AF%95"><span class="toc-number">1.12.</span> <span class="toc-text">动态测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.13.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mockito3"><span class="toc-number">2.</span> <span class="toc-text">Mockito3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">基础教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B"><span class="toc-number">2.1.1.</span> <span class="toc-text">样例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E6%A0%B9"><span class="toc-number">2.1.2.</span> <span class="toc-text">存根</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D%E5%99%A8"><span class="toc-number">2.1.3.</span> <span class="toc-text">参数匹配器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A1%AE%E5%88%87%E7%9A%84%E8%B0%83%E7%94%A8%E6%AC%A1%E6%95%B0-x2F-%E8%87%B3%E5%B0%91x%E6%AC%A1-x2F-%E4%BB%8E%E4%B8%8D"><span class="toc-number">2.1.4.</span> <span class="toc-text">验证确切的调用次数&#x2F; 至少x次&#x2F;从不</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9-void-%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.1.5.</span> <span class="toc-text">对 void 方法进行异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E9%AA%8C%E8%AF%81"><span class="toc-number">2.1.6.</span> <span class="toc-text">顺序验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E4%BF%9D%E4%BA%A4%E4%BA%92%E4%BB%8E%E6%9C%AA%E5%9C%A8%E6%A8%A1%E6%8B%9F%E4%B8%AD%E5%8F%91%E7%94%9F"><span class="toc-number">2.1.7.</span> <span class="toc-text">确保交互从未在模拟中发生</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E5%86%97%E4%BD%99%E8%B0%83%E7%94%A8"><span class="toc-number">2.1.8.</span> <span class="toc-text">查找冗余调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mocks%E5%88%9B%E5%BB%BA%E7%9A%84%E9%80%9F%E8%AE%B0%E2%80%94%E2%80%94-Mock%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.1.9.</span> <span class="toc-text">mocks创建的速记——@Mock注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E7%BB%AD%E8%B0%83%E7%94%A8%E5%AD%98%E6%A0%B9%EF%BC%88%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%BC%8F%E5%AD%98%E6%A0%B9%EF%BC%89"><span class="toc-number">2.1.10.</span> <span class="toc-text">连续调用存根（迭代器式存根）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E8%B0%83%E5%AD%98%E6%A0%B9"><span class="toc-number">2.1.11.</span> <span class="toc-text">回调存根</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#doReturn-doThrow-doAnswer-doNothing-doCallRealMethod-%E6%96%B9%E6%B3%95%E6%97%8F"><span class="toc-number">2.1.12.</span> <span class="toc-text">doReturn()| doThrow()| doAnswer()| doNothing()| doCallRealMethod()方法族</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E8%A7%86%E7%9C%9F%E5%AE%9E%E7%89%A9%E4%BD%93"><span class="toc-number">2.1.13.</span> <span class="toc-text">监视真实物体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%95%E8%8E%B7%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%96%AD%E8%A8%80%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%88%E8%87%AA-1-8-0-%E8%B5%B7%EF%BC%89"><span class="toc-number">2.1.14.</span> <span class="toc-text">捕获进一步断言的参数（自 1.8.0 起）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E6%B3%A8%E9%87%8A%EF%BC%9A-Captor-Spy-InjectMocks-Since-1-8-3"><span class="toc-number">2.1.15.</span> <span class="toc-text">新注释：@Captor, @Spy, @InjectMocks(Since 1.8.3)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E9%AA%8C%E8%AF%81%EF%BC%88%E8%87%AA1-8-5%E8%B5%B7%EF%BC%89"><span class="toc-number">2.1.16.</span> <span class="toc-text">超时验证（自1.8.5起）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%AE%9E%E4%BE%8B%E5%8C%96-Spies%E5%92%8C-InjectMocks%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5%E4%BC%98%E7%82%B9%EF%BC%88%E8%87%AA-1-9-0-%E8%B5%B7%EF%BC%89"><span class="toc-number">2.1.17.</span> <span class="toc-text">自动实例化@Spies和 @InjectMocks构造函数注入优点（自 1.9.0 起）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">2.2.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">3.</span> <span class="toc-text">单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87"><span class="toc-number">3.1.</span> <span class="toc-text">单元测试覆盖率</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/a2aedf2f.html" title="MySQL 性能优化"><img src="/img/luis/bg1.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MySQL 性能优化"></a><div class="content"><a class="title" href="/a2aedf2f.html" title="MySQL 性能优化">MySQL 性能优化</a><time datetime="2025-05-17T02:21:13.000Z" title="发表于 2025-05-17 10:21:13">2025-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/58b301d4.html" title="MySQL 进阶篇"><img src="/img/luis/bg2.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MySQL 进阶篇"></a><div class="content"><a class="title" href="/58b301d4.html" title="MySQL 进阶篇">MySQL 进阶篇</a><time datetime="2025-05-16T08:00:13.000Z" title="发表于 2025-05-16 16:00:13">2025-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/7a3baa07.html" title="MySQL 基础篇"><img src="/img/luis/t7.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="MySQL 基础篇"></a><div class="content"><a class="title" href="/7a3baa07.html" title="MySQL 基础篇">MySQL 基础篇</a><time datetime="2025-05-15T06:51:13.000Z" title="发表于 2025-05-15 14:51:13">2025-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/d5d7710f.html" title="JVM 知识提升"><img src="/img/luis/bg1.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="JVM 知识提升"></a><div class="content"><a class="title" href="/d5d7710f.html" title="JVM 知识提升">JVM 知识提升</a><time datetime="2025-05-10T05:12:02.000Z" title="发表于 2025-05-10 13:12:02">2025-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/e3f46350.html" title="JVM 知识梳理"><img src="/img/luis/bg2.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="JVM 知识梳理"></a><div class="content"><a class="title" href="/e3f46350.html" title="JVM 知识梳理">JVM 知识梳理</a><time datetime="2025-05-09T05:12:02.000Z" title="发表于 2025-05-09 13:12:02">2025-05-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/luis/bg4.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By Luis</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><span>辽 ICP 备 2020012865 号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script defer="defer" src="/js/jquery.slim.min.js"></script><script defer="defer" data-pjax src="/js/cat.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>